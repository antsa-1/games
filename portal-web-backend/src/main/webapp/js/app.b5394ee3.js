(function(){"use strict";var e={1707:function(e,t,s){var a=s(8061),n=s(6252);const i={class:"container"},o=(0,n._)("header",null,[(0,n._)("h2",null,"Welcomes you!")],-1),r=(0,n._)("footer",null,null,-1);function l(e,t,s,a,l,h){const c=(0,n.up)("NavbarTop"),u=(0,n.up)("router-view");return(0,n.wg)(),(0,n.iD)("div",i,[o,(0,n.Wm)(c),(0,n.Wm)(u),r])}var h=s(6612);const c={class:"navbar navbar-expand-lg navbar-light rounded",style:{"background-color":"#BC8F8F"}},u={key:0,class:"container-fluid"},d=(0,n._)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,n._)("span",{class:"navbar-toggler-icon"})],-1),p={id:"navbarSupportedContent",class:"collapse navbar-collapse"},m={class:"navbar-nav me-auto mb-2 mb-lg-0"},g={class:"nav-item"},b=(0,n.Uk)("Home"),y={class:"nav-item"},T=(0,n.Uk)("Games"),v={key:0,class:"nav-item"},w=(0,n.Uk)("Registration"),f={class:"nav-item"},k=(0,n.Uk)(" Terms and conditions "),x={class:"nav-item"},C=(0,n._)("i",{class:"bi bi-megaphone"},null,-1),P=(0,n.Uk)(" Top lists "),B={class:"nav-item"},S=(0,n.Uk)(" Feedback "),I={class:"nav-item"},_=(0,n.Uk)(" Game instructions "),L={class:"navbar-nav ms-auto"},D={class:"nav-item dropdown"},R=(0,n._)("i",{class:"bi bi-person-fill"},null,-1),M=(0,n.Uk)(" User "),A=[R,M],N={key:0},E=(0,n.Uk)("Show profile"),O={key:1},G=(0,n.Uk)("Logout"),H={key:2},V=(0,n.Uk)(" Login "),$={key:1,class:"container-fluid"},U=(0,n._)("div",{class:"spinner-border",role:"status"},[(0,n._)("span",{class:"sr-only"})],-1),q=[U];function z(e,t,s,a,i,o){const r=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("nav",c,[e.loading?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",u,[d,(0,n._)("div",p,[(0,n._)("ul",m,[(0,n._)("li",g,[(0,n.Wm)(r,{class:"nav-link",to:{name:"Home"}},{default:(0,n.w5)((()=>[b])),_:1})]),(0,n._)("li",y,[(0,n.Wm)(r,{class:"nav-link",to:{name:"Lobby"}},{default:(0,n.w5)((()=>[T])),_:1})]),e.authenticated?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("li",v,[(0,n.Wm)(r,{class:"nav-link",to:{name:"Registration"}},{default:(0,n.w5)((()=>[w])),_:1})])),(0,n._)("li",f,[(0,n.Wm)(r,{class:"nav-link",to:{name:"Info"}},{default:(0,n.w5)((()=>[k])),_:1})]),(0,n._)("li",x,[(0,n.Wm)(r,{class:"nav-link",to:{name:"TopLists"}},{default:(0,n.w5)((()=>[C,P])),_:1})]),(0,n._)("li",B,[(0,n.Wm)(r,{class:"nav-link",to:{name:"Feedback"}},{default:(0,n.w5)((()=>[S])),_:1})]),(0,n._)("li",I,[(0,n.Wm)(r,{class:"nav-link",to:{name:"Instructions"}},{default:(0,n.w5)((()=>[_])),_:1})])]),(0,n._)("ul",L,[(0,n._)("li",D,[(0,n._)("a",{class:"nav-link dropdown-toggle",href:"#",id:"navbarDropdown",role:"button",onClick:t[0]||(t[0]=t=>e.toggle=!e.toggle),"data-bs-toggle":"dropdown","aria-expanded":"false"},A),(0,n._)("ul",{class:(0,h.C_)(["dropdown-menu ms-auto",{show:e.toggle}]),"aria-labelledby":"navbarDropdown",onClick:t[1]||(t[1]=t=>e.toggle=!e.toggle)},[e.authenticated?((0,n.wg)(),(0,n.iD)("li",N,[(0,n.Wm)(r,{class:"dropdown-item",to:{name:"Profile",params:{selectedName:e.userName}}},{default:(0,n.w5)((()=>[E])),_:1},8,["to"])])):(0,n.kq)("",!0),e.authenticated?((0,n.wg)(),(0,n.iD)("li",O,[(0,n.Wm)(r,{onClick:e.logout,class:"dropdown-item",to:{name:"Login"}},{default:(0,n.w5)((()=>[G])),_:1},8,["onClick"])])):(0,n.kq)("",!0),e.authenticated?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("li",H,[(0,n.Wm)(r,{class:"dropdown-item",to:{name:"Login"}},{default:(0,n.w5)((()=>[V])),_:1})]))],2)])])])])),e.loading?((0,n.wg)(),(0,n.iD)("div",$,q)):(0,n.kq)("",!0)])}const W={data(){return{token:null}},computed:{authenticated(){let e=this.$store.getters.user;return!(!e||!e.token||e.token.startsWith("null")||e.token.startsWith("Anom:"))},userName(){return this.$store.getters.user?.name},user(){return this.$store.getters.user}},created(){},methods:{getToken(){const e=this.$store.getters.user;return e?e.token:null},logout(){return this.$store.dispatch("logout",this.$store.getters.user)}}};var F=(0,n.aZ)({name:"NavbarTop",mixins:[W],props:{msg:String},data(){return{toggle:!1}},created(){},computed:{loading(){return this.$store.getters.loadingStatus}},methods:{}}),Y=s(3744);const Q=(0,Y.Z)(F,[["render",z]]);var Z=Q,J=(0,n.aZ)({name:"Games",components:{NavbarTop:Z},mixins:[W],data(){return{title:""}},async created(){if(!this.user){const e=sessionStorage.getItem("userName"),t=sessionStorage.getItem("token");let s={name:e,token:t,webSocket:null};if(e&&!e.startsWith("Anon")){}await this.$store.dispatch("setUser",s)}},methods:{}});const X=(0,Y.Z)(J,[["render",l]]);var j=X;const K={key:0,class:"row"},ee={class:"row"},te={class:"col-md-6 offset-md-3 alert alert-info"},se=(0,n._)("br",null,null,-1),ae={key:1,class:"row"},ne={class:"col m-2"},ie=(0,n._)("h3",null,"Login ",-1),oe=(0,n.Uk)(" UserName: "),re=(0,n._)("br",null,null,-1),le={key:2,class:"row"},he={class:"col m-2"},ce=(0,n.Uk)(" Password: "),ue=["disabled"],de={key:3,class:"row d-inline-flex p-2 alert-danger",role:"alert"};function pe(e,t,s,i,o,r){return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.authenticated?((0,n.wg)(),(0,n.iD)("div",K,[(0,n._)("div",ee,[(0,n._)("div",te,[(0,n.Uk)(" Welcome "+(0,h.zw)(e.userName)+" ",1),se])])])):(0,n.kq)("",!0),e.authenticated?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",ae,[(0,n._)("div",ne,[ie,(0,n._)("div",null,[oe,(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.usrNameTemp=t),class:"p-3",type:"text"},null,512),[[a.nr,e.usrNameTemp]]),re])])])),e.authenticated?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",le,[(0,n._)("div",he,[ce,(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.usrPwTemp=t),class:"p-3",type:"password"},null,512),[[a.nr,e.usrPwTemp]]),(0,n._)("div",null,[(0,n._)("button",{onClick:t[2]||(t[2]=(...t)=>e.login&&e.login(...t)),disabled:e.isLoginButtonDisabled},"Login",8,ue)])])])),e.errorFromLogin?((0,n.wg)(),(0,n.iD)("div",de," Login error occured! ")):(0,n.kq)("",!0)],64)}var me=(0,n.aZ)({name:"Login",mixins:[W],props:{token:String},data(){return{loginToken:null,usrNameTemp:null,usrPwTemp:null,loginError:null,loginRequestOnTheFly:!1}},computed:{isLoginButtonDisabled(){return!!this.loginRequestOnTheFly||(!this.usrNameTemp||!this.usrPwTemp||(this.usrNameTemp.length<1||this.usrPwTemp.length<1))},errorFromLogin(){return null!=this.loginError}},created(){},methods:{login(){this.logout().then((()=>{this.loginError=null,this.loginRequestOnTheFly=!0;const e={method:"POST",headers:{"Content-Type":"application/json",Authorization:null},body:JSON.stringify({userName:this.usrNameTemp,password:this.usrPwTemp})},t="http://35.217.7.146/portal/api/user/login";this.$store.dispatch("setLoadingStatus",!0),fetch(t,e).then((e=>(this.resetLoginData(),200!==e.status?Promise.reject("error in login"):e.json()))).then((e=>{let t={name:e.name,token:e.activeLoginId};this.$store.dispatch("setUser",t)}),(()=>{this.loginError=!0})).finally((()=>{this.loginRequestOnTheFly=!1,this.$store.dispatch("setLoadingStatus",!1)}))}))},resetLoginData(){this.usrName=null,this.pw=null}}});const ge=(0,Y.Z)(me,[["render",pe]]);var be=ge;const ye={class:"row mt-3"},Te={class:"col-xs-12 col-sm-4 mt-3 mt-md-0 pt-3"},ve=(0,n._)("span",{class:"fw-bold"}," Players ",-1),we={class:"list-group"},fe=["onClick"],ke={class:"float-start"},xe={key:0,xmlns:"http://www.w3.org/2000/svg",width:"23",height:"23",fill:"currentColor",class:"bi bi-arrow-left",viewBox:"0 0 16 16"},Ce=(0,n._)("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"},null,-1),Pe=[Ce],Be={key:0,class:"bi bi-star float-end tooltipselector",title:"ConnectFour ranking"},Se={key:1,class:"bi bi-suit-diamond float-end tooltipselector",title:"TicTacToe ranking"},Ie={class:"col-xs-12 col-sm-4 mt-3 mt-md-0"},_e={class:"row"},Le={class:"col-xs-6"},De=(0,n._)("span",{class:"fw-bold"}," Tables ",-1),Re={class:"float-end"},Me={key:0,type:"button",class:"btn btn-primary w-30 float-start","data-bs-toggle":"modal","data-bs-target":"#createTableModal"},Ae={class:"row"},Ne={key:0,class:"table"},Ee=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",{scope:"col"},"Table"),(0,n._)("th",{scope:"col"},"Board"),(0,n._)("th",{scope:"col"},"Playing"),(0,n._)("th",{scope:"col"},"Starter"),(0,n._)("th",{scope:"col"},"Time"),(0,n._)("th",{scope:"col"},"Action")])],-1),Oe={scope:"row"},Ge={key:0},He=["disabled","onClick"],Ve=["onClick"],$e={key:2},Ue={key:1,class:"col fw-bold"},qe=(0,n._)("span",{class:"float-start"}," No tables at the moment. ",-1),ze=[qe],We={class:"modal fade",id:"createTableModal",tabindex:"-1","aria-labelledby":"createTableModalLabel","aria-hidden":"true"},Fe={class:"modal-dialog"},Ye={class:"modal-content"},Qe=(0,n._)("div",{class:"modal-header"},[(0,n._)("h5",{class:"modal-title",id:"createTableModalLabel"},"Create table"),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ze={class:"modal-body col-xs-12"},Je={class:"",role:"group","aria-label":"Select game",id:"select-game"},Xe={value:0,key:0},je=["value"],Ke={class:""},et={key:0,class:"",id:"v-model-select-dynamic"},tt={value:"0",key:0},st=["value"],at={class:"form-check",id:"computer_selection"},nt=(0,n._)("label",{class:"",for:"computerSelection"},"Play against computer",-1),it={class:"form-check",id:"only_registered"},ot=(0,n._)("label",{class:"",for:"onlyRegistered"},"Play only against registered",-1),rt={key:0,class:"form-check",id:"random_starter"},lt=(0,n._)("label",{class:"",for:"randomStarter"},"Random starter",-1),ht={key:0},ct=(0,n.Uk)(" Time control "),ut=["value"],dt={class:"modal-footer justify-content-between"},pt=(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),mt=["disabled"];function gt(e,t,s,i,o,r){return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",ye,[(0,n._)("div",Te,[ve,(0,n._)("ul",we,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.users,((t,s)=>((0,n.wg)(),(0,n.iD)("li",{key:t.name,onClick:s=>e.openProfile(t.name),class:(0,h.C_)(["list-group-item bg-success p-2 text-dark",[s%2==0?"bg-opacity-25":" bg-opacity-10",t.name.startsWith("Anonym")?"":"games-profile-link"]])},[(0,n._)("div",ke,[(0,n.Uk)((0,h.zw)(t.name)+" ",1),t.name===e.userName?((0,n.wg)(),(0,n.iD)("svg",xe,Pe)):(0,n.kq)("",!0)]),t.rankingConnectFour>0?((0,n.wg)(),(0,n.iD)("i",Be,"  "+(0,h.zw)(e.fixVal(t.rankingConnectFour))+"  ",1)):(0,n.kq)("",!0),t.rankingTictactoe>0?((0,n.wg)(),(0,n.iD)("i",Se,"  "+(0,h.zw)(e.fixVal(t.rankingTictactoe))+"  ",1)):(0,n.kq)("",!0)],10,fe)))),128))])]),(0,n._)("div",Ie,[(0,n._)("div",_e,[(0,n._)("div",Le,[De,(0,n._)("span",Re,[e.hasCreatedTable?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("button",Me," Create table ")),e.isRemoveTableButtonVisible?((0,n.wg)(),(0,n.iD)("button",{key:1,onClick:t[0]||(t[0]=t=>e.removeTable()),type:"button",class:"btn btn-primary bg-danger w-30 float-start"}," Remove table ")):(0,n.kq)("",!0)])])]),(0,n._)("div",Ae,[e.tablesExist?((0,n.wg)(),(0,n.iD)("table",Ne,[Ee,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.tables,(t=>((0,n.wg)(),(0,n.iD)("tr",{key:t.id},[(0,n._)("td",Oe,(0,h.zw)(e.getTableGameShortDesc(t.gameMode.id)),1),(0,n._)("td",null,(0,h.zw)(e.getBoardDesc(t)),1),(0,n._)("td",null,(0,h.zw)(t.playerA.name)+" - "+(0,h.zw)(t.playerB?.name),1),(0,n._)("td",null,(0,h.zw)(t.randomizeStarter?"?":"fixed"),1),(0,n._)("td",null,(0,h.zw)(this.getTimeControl(t))+"s ",1),(0,n._)("td",null,[e.hasCreatedTable?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("section",Ge,[e.playButtonVisible(t)?((0,n.wg)(),(0,n.iD)("button",{key:0,disabled:!e.createTableButtonVisible,onClick:s=>e.play(t),type:"button",class:"btn btn-primary w-30 float-start"}," Play ",8,He)):(0,n.kq)("",!0),t.playerA&&t.playerB?((0,n.wg)(),(0,n.iD)("button",{key:1,onClick:s=>e.watchTable(t),type:"button",class:"btn btn-primary w-30 float-end"}," Watch ",8,Ve)):this.authenticated||e.playButtonVisible(t)?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("span",$e,"Requires login to play"))]))])])))),128))])])):((0,n.wg)(),(0,n.iD)("div",Ue,ze))])])]),(0,n._)("div",We,[(0,n._)("div",Fe,[(0,n._)("div",Ye,[Qe,(0,n._)("div",Ze,[(0,n._)("div",Je,[(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedGame=t),onChange:t[2]||(t[2]=(...t)=>e.onSelectedGameChange&&e.onSelectedGameChange(...t))},[((0,n.wg)(),(0,n.iD)("option",Xe," Select game ")),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.games,(e=>((0,n.wg)(),(0,n.iD)("option",{value:e.gameId,key:e.id},(0,h.zw)(e.name),9,je)))),128))],544),[[a.bM,e.selectedGame]])]),(0,n._)("div",Ke,["0"!==e.selectedGame?((0,n.wg)(),(0,n.iD)("div",et,[(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[3]||(t[3]=t=>e.selectedGameMode=t)},[((0,n.wg)(),(0,n.iD)("option",tt," Select variant ")),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.gameModes,(e=>((0,n.wg)(),(0,n.iD)("option",{value:e.id,key:e.id},(0,h.zw)(e.name),9,st)))),128))],512),[[a.bM,e.selectedGameMode]])])):(0,n.kq)("",!0)]),(0,n._)("div",at,[(0,n.wy)((0,n._)("input",{class:"",type:"checkbox",id:"computerSelection",onChange:t[4]||(t[4]=(...t)=>e.onComputerSelectionChange&&e.onComputerSelectionChange(...t)),"onUpdate:modelValue":t[5]||(t[5]=t=>e.playAgainstComputerChecked=t)},null,544),[[a.e8,e.playAgainstComputerChecked]]),nt]),(0,n._)("div",it,[(0,n.wy)((0,n._)("input",{class:"",type:"checkbox",id:"onlyRegistered","onUpdate:modelValue":t[6]||(t[6]=t=>e.onlyRegistered=t)},null,512),[[a.e8,e.onlyRegistered]]),ot]),3===e.selectedGame?((0,n.wg)(),(0,n.iD)("div",rt,[(0,n.wy)((0,n._)("input",{class:"",type:"checkbox",id:"randomStarter","onUpdate:modelValue":t[7]||(t[7]=t=>e.randomStarterChecked=t)},null,512),[[a.e8,e.randomStarterChecked]]),lt])):(0,n.kq)("",!0),(0,n._)("div",null,[3===e.selectedGame?((0,n.wg)(),(0,n.iD)("div",ht,[ct,(0,n._)("div",null,[(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[8]||(t[8]=t=>e.selectedTimeControl=t),onChange:t[9]||(t[9]=(...t)=>e.timeControl&&e.timeControl(...t))},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.getTimeControls(),(e=>((0,n.wg)(),(0,n.iD)("option",{value:e.id,key:e.id},(0,h.zw)(e.seconds)+" seconds ",9,ut)))),128))],544),[[a.bM,e.selectedTimeControl]])])])):(0,n.kq)("",!0)])]),(0,n._)("div",dt,[pt,(0,n._)("button",{disabled:e.modalCreateTableDisabled,onClick:t[10]||(t[10]=(...t)=>e.createTable&&e.createTable(...t)),type:"button","data-bs-dismiss":"modal",class:"btn btn-primary"}," Create table ",8,mt)])])])])],64)}var bt,yt,Tt;(function(e){e["O"]="O",e["X"]="X"})(bt||(bt={})),function(e){e["GAME"]="G",e["RESIGNITION"]="R"}(yt||(yt={})),function(e){e[e["WIN_BY_PLAY"]=1]="WIN_BY_PLAY",e[e["WIN_BY_TIME"]=2]="WIN_BY_TIME",e[e["WIN_BY_RESIGNATION"]=3]="WIN_BY_RESIGNATION",e[e["WIN_BY_DISCONNECT"]=4]="WIN_BY_DISCONNECT",e[e["DRAW"]=5]="DRAW",e[e["LEFT_TABLE"]=6]="LEFT_TABLE"}(Tt||(Tt={}));const vt={data(){return{token:null}},computed:{},created(){},methods:{convertInstantToDate(e){return new Date(e).toLocaleDateString()},convertInstantToTime(e){return new Date(e).toLocaleTimeString()},convertResultToText(e){const t=Tt[e];return t.toLowerCase()},getRankingChange(e,t){if(e&&t){const s=t>=e?"-":"+",a=Math.abs(e-t),n=s.concat(a.toFixed());return n}},fixVal(e){return e.toFixed()}}},wt={data(){return{token:null}},computed:{resignButtonDisabled(){this.$store.getters.theTable;return!!this.watch||(!(!this.theTable||this.theTable.playerInTurn)||this.theTable.playerInTurn.name!==this.userName)},rematchButtonEnabled(){const e=this.$store.getters.theTable;return!this.watch&&null===e.playerInTurn},resignButtonVisible(){return this.userName===this.theTable?.playerA?.name||this.userName===this.theTable?.playerB?.name},theTable(){return this.$store.getters.theTable}},timeLeft(){return this.secondsLeft},theTable(){return this.$store.getters.theTable},watchers(){return this.$store.getters.theTable.watchers},created(){this.theTable?.playerInTurn?.name===this.userName&&(this.startTime=120)},methods:{stopReducer(){clearInterval(this.redurcerInterval),this.secondsLeft=null},playMoveNotification(){if(this.soundOn){const e=new window.AudioContext,t=e.createOscillator();t.type="sine",t.frequency.setValueAtTime(446,e.currentTime),t.connect(e.destination),t.start(),setTimeout((()=>{t.stop()}),250)}},removeMouseListeners(){this.canvas.removeEventListener("click",this.handleClick,!1)},disableBoard(){console.log("disable")},rematch(){const e={title:"REMATCH",message:""};this.user.webSocket.send(JSON.stringify(e))},resign(){const e={title:"RESIGN",message:this.tablea};this.user.webSocket.send(JSON.stringify(e))},leaveTable(){const e={title:"LEAVE_TABLE",message:this.theTable.tableId};this?.user?.webSocket?.send(JSON.stringify(e)),this.$store.dispatch("clearTable")},openTable(e){this.$router.push({name:this.getTableName(e.gameMode.gameNumber),id:e.tableId})},openWatcherTable(e){this.$router.push({name:this.getTableName(e.gameMode.gameNumber),id:e.tableId,params:{watch:"1"}})},getTableName(e){return 1===e?"TableTicTacToe":2===e?"TableConnectFour":3===e?"PoolTable":void 0},getTimeControls(){return[{id:0,seconds:120},{id:1,seconds:90},{id:2,seconds:60},{id:3,seconds:45},{id:4,seconds:30},{id:5,seconds:20}]},isPlayerInTurn(e){return this.theTable.playerInTurn.name===e},isTurnChange(e){return this.$store.getters.playerInTurn.name!==e},isTurnChangeToMe(e){return e.playerInTurn.name===this.userName&&this.$store.getters.playerInTurn.name!==this.userName},isTurnChangeFromMe(e){return e.playerInTurn.name!==this.userName&&this.$store.getters.playerInTurn.name===this.userName},isTurnChangeToMe2(e){return console.log("isTurnChangeToMe2 nextPlayer:"+e+"  storePlayerinInTurn "+this.$store.getters.playerInTurn.name+"  myName:"+this.userName),e===this.userName&&this.$store.getters.playerInTurn.name!==this.userName},shouldChangeTurn(e){return!!this.$store.getters.playerInTurn&&this.$store.getters.playerInTurn.name!==e.name},async changeTurnIfRequired(e){this.shouldChangeTurn(e)&&await this.$store.dispatch("changeTurn",e)},isMe(e){return this.userName===e},isMyTurnInStore(){return this.theTable?.playerInTurn?.name===this.userName},playNotificationSound(){const e=new window.AudioContext,t=e.createOscillator();t.type="sine",t.frequency.setValueAtTime(446,e.currentTime),t.connect(e.destination),t.start(),setTimeout((()=>{t.stop()}),0)}}};s(2801);const ft={mixins:[W,wt],data(){return{p:0}},computed:{},created(){},methods:{sendPocketSelection(e){e=null===e?0:e;const t={title:"POOL_SELECT_POCKET",message:this.theTable.tableId,pool:{selectedPocket:e}};console.log("*** Sending pocket selection to server"+JSON.stringify(t)),this.user.webSocket.send(JSON.stringify(t))},hb(e,t,s){let a={x:e,y:t},n={position:a};const i={title:"POOL_HANDBALL",message:this.theTable.tableId,pool:{cueBall:n,canvas:{x:s.width,y:s.height}}};console.log("*** Sending handball to server"+JSON.stringify(i)),this.user.webSocket.send(JSON.stringify(i))},sendTurn(e,t,s){const a={title:"POOL_PLAY_TURN",message:this.theTable.tableId,pool:{cue:this.prepareTransfer(e),cueBall:this.prepareTransfer(t),canvas:{x:s.width,y:s.height}}};console.log("*** Sending turn to server"+JSON.stringify(a)),this.user.webSocket.send(JSON.stringify(a))},sp(e,t,s){const a={title:"POOL_UPDATE",message:this.theTable.tableId,pool:{cue:this.prepareTransfer(e),cueBall:this.prepareTransfer(t),canvas:{x:s.width,y:s.height}}};this.user.webSocket.send(JSON.stringify(a))},prepareHandBall(e){const{image:t,color:s,...a}=e;return a},prepareTransfer(e){const{image:t,color:s,...a}=e;return a},t(e,t,s,a,n,i=!1){this.p||(this.p=!0,setTimeout((()=>{e(s,a,n),this.p=atob("dHJ1ZQ==")<"m"&&"YmFzZTY0IGlzIG5vIGVuY3J5cHRpb24gCg=="}),t))},isHandBall(e){return"HANDBALL"===e.pool.turnResult},isOngoingGame(){return!!this.theTable&&!!this.theTable.playerInTurn},getClosestPocket(e){return e.offsetY<this.canvas.height/2?e.offsetX<this.canvas.width/3?0:e.offsetX<.66*this.canvas.width?1:2:e.offsetX<this.canvas.width/3?5:e.offsetX<.66*this.canvas.width?4:3}}};var kt=(0,n.aZ)({name:"Lobby",mixins:[W,vt,wt,ft],data(){return{createTableButtonVisible:!0,watchTableButtonDisabled:!1,removeTableButtonVisible:!1,selectedGame:"0",selectedGameMode:"0",selectedTimeControl:0,playAgainstComputerChecked:!1,randomStarterChecked:!1,onlyRegistered:!1,computerLevel:"0"}},computed:{users(){return this.$store.getters.users},tables(){return this.$store.getters.tables},games(){return this.$store.getters.games},gameModes(){return 1===this.selectedGame?this.$store.getters.games.filter((e=>1===e.gameId))[0].gameModes:2===this.selectedGame?this.$store.getters.games.filter((e=>2===e.gameId))[0].gameModes:3===this.selectedGame?this.$store.getters.games.filter((e=>3===e.gameId))[0].gameModes:void 0},modalCreateTableDisabled(){return"0"===this.selectedGameMode},tablesExist(){return this.$store.getters.tables.length>0},hasCreatedTable(){const e=this.$store.getters.tables[0];return!(!e||!e.playerA)&&e.playerA.name===this.userName},isRemoveTableButtonVisible(){const e=this.$store.getters.tables[0];return!(!e||!e.playerA)&&e.playerA.name===this.userName}},created(){this.user&&!this.user.webSocket&&this.connect(this.user.token)},methods:{connect(e){let t=new WebSocket("ws://35.217.7.146:80/games/ws");t.onopen=e=>{const s="LOGIN",a={title:s,message:this.user.token},n=(JSON.stringify(a),JSON.stringify(a));t.send(n)},t.onmessage=e=>{let s=JSON.parse(e.data);switch(s.title){case"LOGIN":let e={name:s.to,token:s.token,webSocket:t};this.$store.dispatch("setUser",e).then((()=>{this.$store.dispatch("setUsers",s.players),this.$store.dispatch("setGames",s.games),this.$store.dispatch("setTables",s.tables)}));break;case"CREATE_TABLE":this.$store.dispatch("addTable",s.table),s.table.playerA.name===this.userName&&(this.createTableButtonVisible=!1,this.removeTableButtonVisible=!0);break;case"REMOVE_PLAYER":this.$store.dispatch("leaveTable",s.who.name).then((()=>{this.$store.dispatch("removePlayer",s.who),s.table&&this.$store.dispatch("removeTable",s.table)}));break;case"REMOVE_TABLE":this.$store.dispatch("removeTable",s.table);const a=s.table;a.playerA&&a.playerA.name===this.userName&&(this.createTableButtonVisible=!0,this.removeTableButtonVisible=!1);break;case"NEW_PLAYER":this.$store.dispatch("addPlayer",s.who);break;case"START_GAME":this.$store.dispatch("startGame",s.table).then((()=>{const e=s.table;e.playerA.name!==this.userName&&e.playerB.name!==this.userName||(e.playerA.wins=0,e.playerB.wins=0,this.createTableButtonVisible=!1,this.removeTableButtonVisible=!1,this.watchTableButtonVisible=!1,this.$store.dispatch("selectTable",s.table).then((()=>{this.openTable(s.table)})))}));break;case"MOVE":const n={x:s.x,y:s.y,coordinates:s.x.toString().concat(s.y.toString()),token:s.token};this.$store.dispatch("move",n),this.$store.dispatch("changeTurn",s.table.playerInTurn);break;case"WATCH":console.log("watch arrived selecting table "+s.table),this.$store.dispatch("selectTable",s.table).then((()=>{this.openWatcherTable(s.table)}));break;case"ADD_WATCHER":this.$store.dispatch("addWatcher",s.who).then((()=>{}));break;case"CHAT":const i={text:s.message,from:s.from};if("COMMON"===s.to)return void this.$store.dispatch("updateCommonChat",i);this.$store.dispatch("chat",i);break;case"REMATCH":this.$store.dispatch("rematch",s.table).then((()=>{}));break;case"POOL_UPDATE":this.$store.dispatch("poolUpdate",s);break;case"POOL_SELECT_POCKET":this.$store.dispatch("poolSelectPocket",s);break;case"POOL_HANDBALL":if("HANDBALL_FAIL"===s.pool.turnResult)this.$store.dispatch("poolSetHandBallFail",s);else{this.$store.dispatch("poolSetHandBall",s);const e={from:s.from,text:"Handball set by "+s.table.playerInTurn.name};this.$store.dispatch("chat",e)}break;case"POOL_PLAY_TURN":this.$store.dispatch("poolPlayTurn",s).then((()=>{}));break;case"LEAVE_TABLE":this.$store.dispatch("leaveTable",s);break;case"GAME_END":const o={x:s.x,y:s.y,coordinates:s.x.toString().concat(s.y.toString()),token:s.token};if(3!==s.table.gameMode.gameNumber){if(this.$store.dispatch("move",o),"DRAW"===s.gameResult.resultType){const e={table:s.table,win:s.win};this.$store.dispatch("setDraw",e)}else{const e={winner:s.gameResult.winner.name,reason:yt.GAME,winsA:s.table.playerA.wins,winsB:s.table.playerB.wins,from:"System"};this.$store.dispatch("updateScore",e);const t={fromX:s.gameResult.fromX,fromY:s.gameResult.fromY,toX:s.gameResult.toX,toY:s.gameResult.toY,resultType:s.gameResult.resultType,winner:{name:s.gameResult.winner.name}};this.$store.dispatch("updateWinner",t)}return}3===s.table.gameMode.gameNumber&&(this.$store.dispatch("poolPlayTurn",s),this.$store.dispatch("poolGameEnded",s));break;case"RESIGN":const r={winner:s.who.name,reason:s.reason,winsA:s.table.playerA.wins,winsB:s.table.playerB.wins,from:s.from};this.$store.dispatch("resign",r);const l="R"===s.message?yt.RESIGNITION:yt.GAME;let h=s.who.name.concat(l===yt.RESIGNITION?" won by resignation":" won");const c={from:s.from,text:h};this.$store.dispatch("chat",c);break}},t.onerror=e=>{},t.onclose=e=>{this.user&&(this.user.webSocket=null)}},createTable(){let e=null;if(e={title:"CREATE_TABLE",message:this.selectedGameMode,computer:this.playAgainstComputerChecked,randomStarter:this.randomStarterChecked,onlyRegistered:this.onlyRegistered},30===this.selectedGameMode){let t=this.selectedTimeControl;t||(t=0),e.timeControlIndex=t}this.user.webSocket.send(JSON.stringify(e)),this.computerLevel=null,this.playAgainstComputerChecked=!1,this.randomStarterChecked=!1,this.selectedTimeControl=null},getTableGameShortDesc(e){return e<20?"x.o":e<30?"4x":"Pool"},getBoardDesc(e){return e.gameMode.gameNumber<3?e.x+" x "+e.y:3===e.gameMode.gameNumber?"8-ball":"err"},onComputerSelectionChange(){this.playAgainstComputerChecked||(this.computerLevel="0")},onSelectedGameChange(e){3!==e.target.selectedIndex?this.selectedGameMode="0":this.selectedGameMode=30},removeTable(){const e={title:"REMOVE_TABLE",message:""};this.user.webSocket.send(JSON.stringify(e))},play(e){const t={title:"JOIN_TABLE",message:e.tableId};this.user.webSocket.send(JSON.stringify(t))},playButtonVisible(e){return(!e.playerA||!e.playerB)&&!(e.registeredOnly&&!this.authenticated)},isOwnTable(e){return e?.playerA?.name===this.userName},watchTable(e){const t={title:"WATCH",message:e.tableId};this.user.webSocket.send(JSON.stringify(t))},openProfile(e){e.startsWith("Anonym")||this.$router.push({name:"Profile",params:{selectedName:e}})},getTimeControl(e){return this.getTimeControls()[e.timeControlIndex].seconds}}});const xt=(0,Y.Z)(kt,[["render",gt]]);var Ct=xt;const Pt=(0,n.uE)('<div class="row" data-v-3b0cb7b0><div class="col fw-bold" data-v-3b0cb7b0> Hi! </div></div><div class="row mt-4" data-v-3b0cb7b0><div class="col question" data-v-3b0cb7b0> Play without registering <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 25 25" data-v-3b0cb7b0><path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z" data-v-3b0cb7b0></path></svg></div><div class="col" data-v-3b0cb7b0><p class="text-start" data-v-3b0cb7b0> 1. Click Games on the top navigation bar <br data-v-3b0cb7b0> 2. Join table <br data-v-3b0cb7b0> 3. Or create your own table with selected options <br data-v-3b0cb7b0> 4. Invite your friend to play or wait for random player </p></div></div><div class="row" data-v-3b0cb7b0><div class="col question" data-v-3b0cb7b0> Play with nickname <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 25 25" data-v-3b0cb7b0><path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z" data-v-3b0cb7b0></path></svg></div><div class="col" data-v-3b0cb7b0><p class="text-start" data-v-3b0cb7b0> 1. Click Registration <br data-v-3b0cb7b0> 2. Type nickname and password <br data-v-3b0cb7b0> 3. After registration, login and click play <br data-v-3b0cb7b0></p></div></div>',3);function Bt(e,t,s,a,n,i){return Pt}var St=(0,n.aZ)({name:"Home",methods:{toMainPage(){this.$router.push("/")}},created(){}});const It=(0,Y.Z)(St,[["render",Bt],["__scopeId","data-v-3b0cb7b0"]]);var _t=It;const Lt=e=>((0,n.dD)("data-v-74b8d9bc"),e=e(),(0,n.Cn)(),e),Dt={class:"row"},Rt={class:"col"},Mt=["disabled"],At={class:"row"},Nt={class:"col-xs-12 col-sm-4"},Et=Lt((()=>(0,n._)("br",null,null,-1))),Ot=Lt((()=>(0,n._)("label",{class:"form-check-label ms-1",for:"highlight"},"Highlight last",-1))),Gt=Lt((()=>(0,n._)("br",null,null,-1))),Ht=Lt((()=>(0,n._)("label",{class:"form-check-label ms-1",for:"soundOn"},"Notification sound",-1))),Vt=Lt((()=>(0,n._)("br",null,null,-1))),$t=Lt((()=>(0,n._)("br",null,null,-1))),Ut=(0,n.Uk)(" vs. "),qt=Lt((()=>(0,n._)("br",null,null,-1))),zt={key:2,class:"text-success"},Wt={key:3,class:"text-success"},Ft={key:4,class:"text-danger"},Yt={class:"text-danger"},Qt={class:"col-xs-12 col-sm-8"};function Zt(e,t,s,i,o,r){const l=(0,n.up)("chat");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",Dt,[(0,n._)("div",Rt,[e.resignButtonVisible?((0,n.wg)(),(0,n.iD)("button",{key:0,disabled:e.resignButtonDisabled,onClick:t[0]||(t[0]=(...t)=>e.resign&&e.resign(...t)),type:"button",class:"btn btn-primary w-30 float-xs-start float-sm-end"}," Resign ",8,Mt)):(0,n.kq)("",!0),e.rematchButtonEnabled?((0,n.wg)(),(0,n.iD)("button",{key:1,onClick:t[1]||(t[1]=(...t)=>e.rematch&&e.rematch(...t)),type:"button",class:"btn btn-primary w-30 float-xs-start float-sm-end"}," Rematch ")):(0,n.kq)("",!0)])]),(0,n._)("div",At,[(0,n._)("div",Nt,[(0,n.Uk)(" Connect "+(0,h.zw)(e.theTable.gameMode.requiredConnections)+" to win ",1),Et,(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox",id:"highlight",onChange:t[2]||(t[2]=(...t)=>e.highlightLastSquareIfSelected&&e.highlightLastSquareIfSelected(...t)),"onUpdate:modelValue":t[3]||(t[3]=t=>e.showLastVal=t)},null,544),[[a.e8,e.showLastVal]]),Ot,Gt,(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox",id:"soundOn","onUpdate:modelValue":t[4]||(t[4]=t=>e.soundOn=t)},null,512),[[a.e8,e.soundOn]]),Ht,Vt,e.theTable.playerA?((0,n.wg)(),(0,n.iD)("span",{key:0,class:(0,h.C_)(["fw-bold",{"text-success":e.theTable.playerInTurn?.name===e.theTable?.playerA?.name}])},(0,h.zw)(e.theTable?.playerA?.gameToken)+" = "+(0,h.zw)(e.theTable?.playerA?.name),3)):(0,n.kq)("",!0),$t,Ut,qt,e.theTable.playerB?((0,n.wg)(),(0,n.iD)("span",{key:1,class:(0,h.C_)(["fw-bold",{"text-success":e.theTable.playerInTurn?.name===e.theTable?.playerB?.name}])},(0,h.zw)(e.theTable?.playerB?.gameToken)+" = "+(0,h.zw)(e.theTable?.playerB?.name),3)):(0,n.kq)("",!0),e.theTable.playerInTurn?.name===e.userName?((0,n.wg)(),(0,n.iD)("span",zt," It's your turn. ")):null===e.theTable?.playerInTurn?((0,n.wg)(),(0,n.iD)("span",Wt," Game ended ")):((0,n.wg)(),(0,n.iD)("div",Ft," In turn: "+(0,h.zw)(e.theTable.playerInTurn?.name),1)),(0,n._)("div",{class:(0,h.C_)({hidden:e.theTable.playerInTurn?.name!==e.userName})},[(0,n._)("span",Yt," Time left "+(0,h.zw)(e.timeLeft),1)],2)]),(0,n._)("div",Qt,[(0,n._)("canvas",{class:(0,h.C_)({"bg-secondary":null==e.theTable.playerInTurn}),id:"canvas"},null,2)])]),(0,n.Wm)(l,{id:e.theTable.id},null,8,["id"])],64)}const Jt={class:"row"},Xt={class:"col overflow-auto",style:{"max-height":"500px !important"}};function jt(e,t,s,a,i,o){return(0,n.wg)(),(0,n.iD)("div",Jt,[(0,n._)("div",Xt,[(0,n._)("ul",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.messagesd,((e,t)=>((0,n.wg)(),(0,n.iD)("li",{key:t,class:(0,h.C_)(["list-group-item rounded-pill text-start w-75 text-break mb-1",[t%2==0?"bg-success p-2 text-dark bg-opacity-25":"bg-success p-2 text-dark bg-opacity-10"]])},"  "+(0,h.zw)(e.from)+":  "+(0,h.zw)(e.text),3)))),128))])])])}var Kt=(0,n.aZ)({name:"Chat",mixins:[W],props:["id","common"],data(){return{messages:null,users:null,message:{text:""}}},computed:{messageExist(){return this.message.text.length>0},messagesd(){return this.common?this.$store.getters.commonChatMessages:this.$store.getters.chatMessages}},created(){},methods:{sendMessage(){let e=this.message.text.trim();if(e.length<1||e.length>75)return void(this.message.text="");const t=this.common?"COMMON":this.id,s={title:"CHAT",message:e,to:t};this.user.webSocket.send(JSON.stringify(s)),this.message.text=""}}});const es=(0,Y.Z)(Kt,[["render",jt]]);var ts=es,ss=(0,n.aZ)({components:{Chat:ts},name:"TableTicTacToe",mixins:[W],props:["watch"],data(){return{horizontalGap:null,verticalGap:null,canvas:null,renderingContext:null,showLastVal:!1,soundOn:!1,secondsLeft:120}},created(){this.unsubscribe=this.$store.subscribe(((e,t)=>{if("move"===e.type){t.theTable.board;this.removeLastSquareHighLightning(),this.drawToken(this.theTable.board[this.theTable.board.length-1]),this.playMoveNotification(),this.highlightLastSquareIfSelected()}else if("changeTurn"===e.type)t.theTable.playerInTurn.name===this.userName?(this.addMouseListener(),this.startReducer()):(this.removeMouseListener(),this.stopReducer());else if("rematch"===e.type)this.initBoard();else if("updateWinner"===e.type){const e=t.theTable.win;this.removeMouseListener(),this.stopReducer(),this.drawWinningLine(e)}else"setDraw"!==e.type&&"resign"!==e.type||(this.stopReducer(),this.removeMouseListener())})),this.theTable.playerInTurn?.name===this.userName&&(this.startTime=120,this.startReducer())},computed:{timeLeft(){return this.secondsLeft},theTable(){return this.$store.getters.theTable},iconColor(){const e=this.$store.getters.theTable.watchers;return e&&e.length>1?"green":"#000000"},watchers(){return this.$store.getters.theTable.watchers},resignButtonDisabled(){this.$store.getters.theTable;return!!this.watch||(!(!this.theTable||this.theTable.playerInTurn)||(this.theTable.playerInTurn.name!==this.userName||!!(this.theTable&&this.theTable.board&&this.theTable.board.length<4)))},rematchButtonEnabled(){const e=this.$store.getters.theTable;return!this.watch&&null===e.playerInTurn},resignButtonVisible(){return this.userName===this.theTable?.playerA?.name||this.userName===this.theTable?.playerB?.name}},mounted(){this.$store.getters.theTable?(this.initBoard(),"1"===this.watch&&this.drawBoard()):this.$router.push("/error")},beforeUnmount(){this.unsubscribe(),this.stopReducer(),this.leaveTable()},methods:{startReducer(){this.redurcerInterval&&this.stopReducer(),this.secondsLeft=120,this.redurcerInterval=setInterval((()=>{this.secondsLeft=this.secondsLeft-1,this.secondsLeft<=0&&(this.stopReducer(),this.resign())}),1e3)},stopReducer(){clearInterval(this.redurcerInterval),this.secondsLeft=null},highlightLastSquareIfSelected(){if(this.showLastVal&&this.theTable.board.length>1){const e=this.theTable.board,t=e[e.length-1];this.drawToken(t,"#FF0000")}},playMoveNotification(){if(this.soundOn){const e=new window.AudioContext,t=e.createOscillator();t.type="sine",t.frequency.setValueAtTime(446,e.currentTime),t.connect(e.destination),t.start(),setTimeout((()=>{t.stop()}),250)}},removeLastSquareHighLightning(){if(this.theTable.board.length>1){const e=this.theTable.board,t=e[e.length-2];this.drawToken(t,"#000000")}},removeMouseListener(){this.canvas.removeEventListener("click",this.handleClick,!1)},addMouseListener(){this.canvas.addEventListener("click",this.handleClick,!1)},drawWinningLine(e){this.renderingContext.beginPath(),this.renderingContext.moveTo(e.fromX*this.horizontalGap+this.horizontalGap/2-10,e.fromY*this.verticalGap+this.verticalGap/2),this.renderingContext.lineTo(e.toX*this.horizontalGap+this.horizontalGap/2+10,e.toY*this.verticalGap+this.verticalGap/2),this.renderingContext.strokeStyle="#00FFFF",this.renderingContext.lineWidth=5,this.renderingContext.stroke()},initBoard(){let e=this.theTable;this.canvas=document.getElementById("canvas"),this.renderingContext=this.canvas.getContext("2d");window.innerHeight,window.innerWidth;this.canvas.height=400,this.canvas.width=400,e.x>=10&&e.x<=20?(this.canvas.height=600,this.canvas.width=600):e.x>20&&(this.canvas.height=800,this.canvas.width=800);let t=e.x-1,s=e.y-1;this.verticalGap=this.canvas.height/e.x,this.horizontalGap=this.canvas.width/e.y;let a=0,n=0;for(let i=0;i<t;i++)a+=this.horizontalGap,this.renderingContext.beginPath(),this.renderingContext.moveTo(a,n),this.renderingContext.lineTo(a,this.canvas.height),this.renderingContext.stroke();a=0,n=0;for(let i=0;i<s;i++)n+=this.verticalGap,this.renderingContext.beginPath(),this.renderingContext.moveTo(a,n),this.renderingContext.lineTo(this.canvas.width,n),this.renderingContext.stroke();this.theTable.playerInTurn.name===this.userName&&this.canvas.addEventListener("click",this.handleClick,!1)},drawBoard(){let e=this.theTable.board;e.forEach((e=>{this.drawToken(e)}))},drawToken(e,t){const s=e.token,a=e.x,n=e.y;if(s==bt.X){const e=Math.floor(a*this.horizontalGap+.1*this.horizontalGap),s=Math.floor(n*this.verticalGap+.1*this.verticalGap);t&&(this.renderingContext.strokeStyle=t),this.renderingContext.beginPath(),this.renderingContext.moveTo(e,s),this.renderingContext.lineTo(e+this.horizontalGap-.2*this.horizontalGap,s+this.verticalGap-.2*this.verticalGap),this.renderingContext.stroke(),this.renderingContext.beginPath(),this.renderingContext.moveTo(e,s+this.verticalGap-.2*this.verticalGap),this.renderingContext.lineTo(e+this.horizontalGap-.2*this.horizontalGap,s),this.renderingContext.stroke()}else{t&&(this.renderingContext.strokeStyle=t);const e=this.horizontalGap/2+a*this.horizontalGap,s=this.verticalGap/2+n*this.verticalGap,i=this.verticalGap/2*.85;this.renderingContext.beginPath(),this.renderingContext.arc(e,s,i,0,2*Math.PI),this.renderingContext.stroke()}},handleClick(e){const t=Math.floor(e.offsetX/this.verticalGap),s=Math.floor(e.offsetY/this.horizontalGap);let a={x:t,y:s,coordinates:t.toString().concat(s.toString())};const n=this.theTable.board.find((e=>e.coordinates===a.coordinates));if(!n){this.removeMouseListener();const e={title:"MOVE",x:a.x,y:a.y};this.user.webSocket.send(JSON.stringify(e)),this.removeMouseListener()}},disableBoard(){return this.renderingContext.font="30px Arial",this.renderingContext.fillText("Game over",10,this.canvas.height/2),!0},rematch(){const e={title:"REMATCH",message:""};this.user.webSocket.send(JSON.stringify(e))},resign(){const e={title:"RESIGN",message:this.tablea};this.user.webSocket.send(JSON.stringify(e))},leaveTable(){const e={title:"LEAVE_TABLE",message:this.theTable.tableId};this?.user?.webSocket?.send(JSON.stringify(e))}}});const as=(0,Y.Z)(ss,[["render",Zt],["__scopeId","data-v-74b8d9bc"]]);var ns=as;const is={key:0,class:"row"},os={class:"row col-md-6 offset-md-3 alert alert-info text-start"},rs=(0,n._)("br",null,null,-1),ls=(0,n._)("br",null,null,-1),hs={class:"row"},cs={key:1,class:"row"};function us(e,t,s,a,i,o){const r=(0,n.up)("GameHistory");return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.memberSince?((0,n.wg)(),(0,n.iD)("div",is,[(0,n._)("div",os,[(0,n._)("b",null,(0,h.zw)(e.selectedName),1),rs,(0,n.Uk)(" Joined: "+(0,h.zw)(e.memberSince)+" ",1),ls,(0,n.Uk)(" "+(0,h.zw)(e.text),1)]),(0,n._)("div",hs,[e.eightBalls.length>0?((0,n.wg)(),(0,n.iD)("div",{key:0,class:(0,h.C_)(["col-xs-12",this.getClass])},[(0,n.Wm)(r,{games:e.eightBalls,title:"Eight ball"},null,8,["games"])],2)):(0,n.kq)("",!0),e.connectFours.length>0?((0,n.wg)(),(0,n.iD)("div",{key:1,class:(0,h.C_)(["col-xs-12",this.getClass])},[(0,n.Wm)(r,{games:e.connectFours,title:"Connect four"},null,8,["games"])],2)):(0,n.kq)("",!0),e.tictactoes.length>0?((0,n.wg)(),(0,n.iD)("div",{key:2,class:(0,h.C_)(["col-xs-12",this.getClass])},[(0,n.Wm)(r,{games:e.tictactoes,title:"TicTacToe"},null,8,["games"])],2)):(0,n.kq)("",!0)])])):(0,n.kq)("",!0),204==e.status||e.status>=400?((0,n.wg)(),(0,n.iD)("div",cs," User not found ")):(0,n.kq)("",!0)],64)}const ds={class:"fw-bold"},ps={class:"list-group"},ms={class:""},gs=(0,n._)("br",null,null,-1),bs=(0,n._)("br",null,null,-1),ys=(0,n._)("br",null,null,-1),Ts={key:0},vs=(0,n._)("br",null,null,-1),ws={key:1};function fs(e,t,s,a,i,o){return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("span",ds,(0,h.zw)(s.title),1),(0,n._)("ul",ps,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.games,((t,s)=>((0,n.wg)(),(0,n.iD)("li",{key:t,class:(0,h.C_)(["list-group-item",[s%2==0?"bg-success p-2 text-dark bg-opacity-25":"bg-success p-2 text-dark bg-opacity-10"]])},[(0,n._)("div",ms,[(0,n.Uk)((0,h.zw)(e.convertInstantToDate(t.startInstant))+" ",1),gs,(0,n.Uk)(" "+(0,h.zw)(t.playerAName)+" - "+(0,h.zw)(t.playerBName)+" ",1),bs,(0,n.Uk)(" "+(0,h.zw)(t.playerAStartRanking)+" ( "+(0,h.zw)(e.getRankingChange(t.playerAEndRanking,t.playerAStartRanking))+" ) vs. "+(0,h.zw)(t.playerBStartRanking)+" ( "+(0,h.zw)(e.getRankingChange(t.playerBEndRanking,t.playerBStartRanking))+" ) ",1),ys,(0,n.Uk)(" Board: "+(0,h.zw)(t.boardDescription)+" ",1),t?.winnerUsername?((0,n.wg)(),(0,n.iD)("p",Ts,[(0,n.Uk)(" Winner: "+(0,h.zw)(t.winnerUsername)+" ",1),vs,(0,n.Uk)(" "+(0,h.zw)(e.convertResultToText(t.result)),1)])):((0,n.wg)(),(0,n.iD)("p",ws,(0,h.zw)(e.convertResultToText(t.result)),1))])],2)))),128))])],64)}var ks={props:{games:Array,title:String},mixins:[vt],data(){return{}}};const xs=(0,Y.Z)(ks,[["render",fs]]);var Cs=xs,Ps=(0,n.aZ)({name:"Profile",mixins:[W],components:{GameHistory:Cs},props:{selectedName:String},data(){return{stats:null,text:null,memberSince:null,connectFours:[],tictactoes:[],status:-1,fetchText:"",eightBalls:[]}},computed:{getClass(){const e=this.eightBalls>0,t=this.tictactoes>0,s=this.connectFours>0;return e&&t&&s?"col-sm-4":"col-sm-6"}},created(){this.fetchProfile()},methods:{fetchProfile(){this.status=-1,this.fetchText="";const e={method:"GET",headers:{"Content-Type":"application/json",Authorization:null}},t="http://35.217.7.146/portal/api/profile/"+this.selectedName;this.$store.dispatch("setLoadingStatus",!0),fetch(t,e).then((e=>(this.status=e.status,200!==e.status?Promise.reject("error fetching profile"):e.json()))).then((e=>{this.text=e.user.profileText,this.memberSince=new Date(e.user.memberSince).toLocaleDateString(),this.tictactoes=e.user.tictactoes,this.connectFours=e.user.connectFours,this.eightBalls=e.user.eightBalls}),(e=>{console.error("error in profile fetch")})).finally((()=>{this.$store.dispatch("setLoadingStatus",!1)}))}}});const Bs=(0,Y.Z)(Ps,[["render",us]]);var Ss=Bs;const Is={class:"row mt-3"},_s=(0,n._)("span",{class:"fw-bold"}," Hall of fame ",-1),Ls=(0,n._)("br",null,null,-1);function Ds(e,t,s,a,i,o){const r=(0,n.up)("Gamers");return(0,n.wg)(),(0,n.iD)("div",Is,[(0,n._)("p",null,[_s,Ls,(0,n.Uk)(" "+(0,h.zw)(e.dateTime),1)]),(0,n.Wm)(r,{games:e.eightBalls,totalGames:e.totalEightBalls,gameNumber:3,title:"Eight ball"},null,8,["games","totalGames"]),(0,n.Wm)(r,{games:e.connectFours,totalGames:e.totalConnectFours,gameNumber:2,title:"ConnectFour"},null,8,["games","totalGames"]),(0,n.Wm)(r,{games:e.tictactoes,totalGames:e.totalTictactoes,gameNumber:1,title:"TicTacToe"},null,8,["games","totalGames"])])}const Rs={class:"col-xs-12 col-sm-4 mt-3 mt-md-0 pt-3"},Ms={class:"fw-bold"},As={class:"list-group"},Ns={class:"float-end"};function Es(e,t,s,a,i,o){const r=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("div",Rs,[(0,n._)("span",Ms,(0,h.zw)(s.title),1),(0,n._)("ul",As,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.games,((e,t)=>((0,n.wg)(),(0,n.iD)("li",{key:e,class:(0,h.C_)(["list-group-item",[t%2==0?"bg-success p-2 text-dark bg-opacity-25":"bg-success p-2 text-dark bg-opacity-10"]])},[(0,n.Wm)(r,{to:{name:"Profile",params:{selectedName:e.nickname}},class:"games-profile-link float-start"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,h.zw)(t+1)+"."+(0,h.zw)(e.nickname),1)])),_:2},1032,["to"]),(0,n._)("span",Ns,(0,h.zw)(this.getRanking(e)),1)],2)))),128))]),(0,n.Uk)(" Games "+(0,h.zw)(s.totalGames),1)])}var Os={name:"Gamers",props:{games:Array,title:String,totalGames:Number,gameNumber:Number},data(){return{}},computed:{},created(){},methods:{getRanking(e){return 3===this.gameNumber?e.rankingEightBall:2===this.gameNumber?e.rankingConnectFour:1===this.gameNumber?e.rankingTicTacToe:void 0}}};const Gs=(0,Y.Z)(Os,[["render",Es]]);var Hs=Gs,Vs=(0,n.aZ)({name:"TopLists",components:{Gamers:Hs},data(){return{connectFours:[],tictactoes:[],eightBalls:[],errorFlag:!1,dateTime:void 0,totalConnectFours:0,totalTictactoes:0,totalEightBalls:0}},computed:{},created(){this.fetchLists()},methods:{fetchLists(){console.log("Ui starts fetch"),this.errorFlag=!1;const e={method:"GET",headers:{"Content-Type":"application/json",Authorization:null}},t="http://35.217.7.146/portal/api/toplists";this.$store.dispatch("setLoadingStatus",!0),fetch(t,e).then((e=>200!==e.status?Promise.reject("error fetching lists"):e.json())).then((e=>{this.connectFours=e.connectFours,this.tictactoes=e.tictactoes,this.eightBalls=e.eightBalls,this.dateTime=new Date(e.instant).toLocaleString(),this.totalConnectFours=e.totalConnectFours,this.totalTictactoes=e.totalTictactoes,this.totalEightBalls=e.totalEightBalls}),(e=>{this.errorFlag=!0})).finally((()=>{this.$store.dispatch("setLoadingStatus",!1)}))}}});const $s=(0,Y.Z)(Vs,[["render",Ds]]);var Us=$s;const qs=e=>((0,n.dD)("data-v-8056ca8c"),e=e(),(0,n.Cn)(),e),zs={class:"row"},Ws={class:"col"},Fs=["disabled"],Ys={class:"row"},Qs={class:"col-xs-12 col-sm-4"},Zs=(0,n.Uk)(" Connect 4 table "),Js=qs((()=>(0,n._)("br",null,null,-1))),Xs=qs((()=>(0,n._)("label",{class:"form-check-label ms-1",for:"highlight"},"Highlight last",-1))),js=qs((()=>(0,n._)("br",null,null,-1))),Ks=qs((()=>(0,n._)("label",{class:"form-check-label ms-1",for:"soundOn"},"Notification sound",-1))),ea=qs((()=>(0,n._)("br",null,null,-1))),ta=qs((()=>(0,n._)("br",null,null,-1))),sa=(0,n.Uk)(" vs. "),aa=qs((()=>(0,n._)("br",null,null,-1))),na={key:2,class:"text-success"},ia={key:3,class:"text-success"},oa={key:4,class:"text-danger"},ra={class:"text-danger"},la={class:"col-xs-12 col-sm-8"};function ha(e,t,s,i,o,r){const l=(0,n.up)("chat");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",zs,[(0,n._)("div",Ws,[e.resignButtonVisible?((0,n.wg)(),(0,n.iD)("button",{key:0,disabled:e.resignButtonDisabled,onClick:t[0]||(t[0]=(...t)=>e.resign&&e.resign(...t)),type:"button",class:"btn btn-primary w-30 float-xs-start float-sm-end"}," Resign ",8,Fs)):(0,n.kq)("",!0),e.rematchButtonEnabled?((0,n.wg)(),(0,n.iD)("button",{key:1,onClick:t[1]||(t[1]=(...t)=>e.rematch&&e.rematch(...t)),type:"button",class:"btn btn-primary w-30 float-xs-start float-sm-end"}," Rematch ")):(0,n.kq)("",!0)])]),(0,n._)("div",Ys,[(0,n._)("div",Qs,[Zs,Js,(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox",id:"highlight",onChange:t[2]||(t[2]=(...t)=>e.highlightLastSquareIfSelected&&e.highlightLastSquareIfSelected(...t)),"onUpdate:modelValue":t[3]||(t[3]=t=>e.showLastVal=t)},null,544),[[a.e8,e.showLastVal]]),Xs,js,(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox",id:"soundOn","onUpdate:modelValue":t[4]||(t[4]=t=>e.soundOn=t)},null,512),[[a.e8,e.soundOn]]),Ks,ea,e.theTable.playerA?((0,n.wg)(),(0,n.iD)("span",{key:0,class:(0,h.C_)(["fw-bold",{"text-success":e.theTable.playerInTurn?.name===e.theTable?.playerA?.name}])},(0,h.zw)(e.theTable?.playerA?.gameToken)+" = "+(0,h.zw)(e.theTable?.playerA?.name),3)):(0,n.kq)("",!0),ta,sa,aa,e.theTable.playerB?((0,n.wg)(),(0,n.iD)("span",{key:1,class:(0,h.C_)(["fw-bold",{"text-success":e.theTable.playerInTurn?.name===e.theTable?.playerB?.name}])},(0,h.zw)(e.theTable?.playerB?.gameToken)+" = "+(0,h.zw)(e.theTable?.playerB?.name),3)):(0,n.kq)("",!0),e.theTable.playerInTurn?.name===e.userName?((0,n.wg)(),(0,n.iD)("span",na," It's your turn. ")):null===e.theTable?.playerInTurn?((0,n.wg)(),(0,n.iD)("span",ia," Game ended ")):((0,n.wg)(),(0,n.iD)("div",oa," In turn: "+(0,h.zw)(e.theTable.playerInTurn?.name),1)),(0,n._)("div",{class:(0,h.C_)({hidden:e.theTable.playerInTurn?.name!==e.userName})},[(0,n._)("span",ra," Time left "+(0,h.zw)(e.timeLeft),1)],2)]),(0,n._)("div",la,[(0,n._)("canvas",{class:(0,h.C_)({"bg-secondary":null==e.theTable.playerInTurn}),id:"canvas"},null,2)])]),(0,n.Wm)(l,{id:e.theTable.id},null,8,["id"])],64)}var ca=(0,n.aZ)({components:{Chat:ts},name:"TableConnectFour",mixins:[W,wt],props:["watch"],data(){return{canvas:null,renderingContext:null,showLastVal:!1,soundOn:!1,secondsLeft:120,startingPosX:-1,startingPosY:-1,gameBoardHeight:-1,gameBoardWidth:-1,arcDiameter:-1,selectedColumn:-1}},created(){this.unsubscribe=this.$store.subscribe(((e,t)=>{if("move"===e.type){t.theTable.board;this.removeLastSquareHighLightning(),this.drawToken(this.theTable.board[this.theTable.board.length-1]),this.playMoveNotification(),this.highlightLastSquareIfSelected()}else if("changeTurn"===e.type)t.theTable.playerInTurn.name===this.userName?(this.addMouseListeners(),this.startReducer()):(this.removeMouseListeners(),this.clearCircleIndicatorRow(),this.stopReducer());else if("rematch"===e.type)this.removeMouseListeners(),this.initBoard(),this.isMyTurnInStore()&&this.startReducer();else if("updateWinner"===e.type){const e=t.theTable.win;this.stopReducer(),this.removeMouseListeners(),this.drawWinningLine(e)}else"setDraw"!==e.type&&"resign"!==e.type||(this.stopReducer(),this.removeMouseListeners())}))},computed:{timeLeft(){return this.secondsLeft},theTable(){return this.$store.getters.theTable},watchers(){return this.$store.getters.theTable.watchers},resignButtonDisabled(){this.$store.getters.theTable;return!!this.watch||(!(!this.theTable||this.theTable.playerInTurn)||(this.theTable.playerInTurn.name!==this.userName||!!(this.theTable&&this.theTable.board&&this.theTable.board.length<4)))},rematchButtonEnabled(){const e=this.$store.getters.theTable;return!this.watch&&null===e.playerInTurn},resignButtonVisible(){return this.userName===this.theTable?.playerA?.name||this.userName===this.theTable?.playerB?.name}},mounted(){this.$store.getters.theTable?(this.initBoard(),"1"===this.watch&&this.drawBoard()):this.$router.push("/error")},beforeUnmount(){this.unsubscribe(),this.stopReducer(),this.leaveTable()},methods:{startReducer(){this.redurcerInterval&&this.stopReducer(),this.secondsLeft=120,this.redurcerInterval=setInterval((()=>{this.secondsLeft--,this.secondsLeft<=0&&(this.stopReducer(),this.resign())}),1e3)},stopReducer(){clearInterval(this.redurcerInterval),this.secondsLeft=null},highlightLastSquareIfSelected(){if(this.showLastVal&&this.theTable.board.length>1){const e=this.theTable.board,t=e[e.length-1];this.drawToken(t,"#FF0000")}},playMoveNotification(){if(this.soundOn){const e=new window.AudioContext,t=e.createOscillator();t.type="sine",t.frequency.setValueAtTime(446,e.currentTime),t.connect(e.destination),t.start(),setTimeout((()=>{t.stop()}),250)}},removeLastSquareHighLightning(){if(this.theTable.board.length>1){const e=this.theTable.board,t=e[e.length-2];this.drawToken(t,"#000000")}},removeMouseListeners(){this.canvas.removeEventListener("click",this.handleClick,!1),this.canvas.removeEventListener("mousemove",this.handleCircleIndicator)},addMouseListeners(){this.canvas.addEventListener("click",this.handleClick,!1),this.canvas.addEventListener("mousemove",this.handleCircleIndicator)},handleCircleIndicator(e){const t=Math.floor((e.offsetX-this.startingPosX)/this.arcDiameter)+1;if(t!=this.column&&t>0&&t<=this.theTable.x){const e=this.column*(this.arcDiameter/2);this.renderingContext.clearRect(e,0,e+this.arcDiameter,this.arcDiameter-3),this.column=t;const s=this.arcDiameter*this.column,a=this.arcDiameter/2;this.renderingContext.fillStyle="red",this.theTable?.playerInTurn?.gameToken===bt.X&&this.userName===this.theTable?.playerInTurn.name&&(this.renderingContext.fillStyle="blue"),this.renderingContext.beginPath(),this.renderingContext.arc(s,a,23,0,2*Math.PI),this.renderingContext.fill()}},clearCircleIndicatorRow(){this.column=-1,this.renderingContext.clearRect(0,0,this.gameBoardWidth,this.arcDiameter-3)},drawWinningLine(e){this.renderingContext.beginPath();const t=(e.fromY+1)*this.arcDiameter,s=(e.fromX+1)*this.arcDiameter+this.arcDiameter/2,a=(e.toY+1)*this.arcDiameter,n=(e.toX+1)*this.arcDiameter+this.arcDiameter/2;this.renderingContext.moveTo(t,s),this.renderingContext.lineTo(a,n),this.renderingContext.strokeStyle="#00FFFF",this.renderingContext.lineWidth=5,this.renderingContext.stroke()},initBoard(){const e=this.theTable;this.canvas=document.getElementById("canvas"),this.renderingContext=this.canvas.getContext("2d"),this.canvas.height=440,this.canvas.width=440,e.x>=10&&e.x<=20?(this.canvas.height=620,this.canvas.width=620):e.x>20&&(this.canvas.height=800,this.canvas.width=800),this.arcDiameter=this.canvas.width/(e.x+1),this.drawBoardFrame(e),this.drawBoardLines(e),this.theTable.playerInTurn?.name===this.userName&&this.addMouseListeners()},drawBoardFrame(e){this.gapBetweenArcs=28,this.gameBoardHeight=e.y*this.arcDiameter,this.gameBoardWidth=e.x*this.arcDiameter,this.startingPosX=this.gapBetweenArcs,this.startingPosY=this.arcDiameter,this.renderingContext.beginPath(),this.renderingContext.rect(this.startingPosX,this.startingPosY,this.gameBoardWidth,this.gameBoardHeight),this.renderingContext.stroke()},drawBoardLines(e){for(let t=0;t<e.x;t++)for(let s=0;s<e.y+1;s++){if(0===s)continue;const e=this.arcDiameter*t+this.arcDiameter,a=this.arcDiameter*s+this.gapBetweenArcs;this.renderingContext.beginPath(),this.renderingContext.arc(e,a,25,0,2*Math.PI),this.renderingContext.stroke()}},drawBoard(){let e=this.theTable.board;e.forEach((e=>{this.drawToken(e)}))},drawToken(e,t){const s=e.token;s==bt.O?this.renderingContext.fillStyle="red":this.renderingContext.fillStyle="blue";const a=this.arcDiameter*(e.x+1)+this.gapBetweenArcs,n=this.arcDiameter*e.y+this.arcDiameter;this.renderingContext.beginPath(),this.renderingContext.arc(n,a,23,0,2*Math.PI),this.renderingContext.stroke(),this.renderingContext.fill()},handleClick(e){const t={title:"MOVE",y:this.column-1};this.user.webSocket.send(JSON.stringify(t))},disableBoard(){return this.renderingContext.font="30px Arial",this.renderingContext.fillText("Game over",10,this.canvas.height/2),!0},rematch(){const e={title:"REMATCH",message:""};this.user.webSocket.send(JSON.stringify(e))},resign(){const e={title:"RESIGN",message:this.tablea};this.user.webSocket.send(JSON.stringify(e))},leaveTable(){const e={title:"LEAVE_TABLE",message:this.theTable.tableId};this?.user?.webSocket?.send(JSON.stringify(e))}}});const ua=(0,Y.Z)(ca,[["render",ha],["__scopeId","data-v-8056ca8c"]]);var da=ua;const pa=e=>((0,n.dD)("data-v-a912993e"),e=e(),(0,n.Cn)(),e),ma={class:"row"},ga={class:"col"},ba=["disabled"],ya={class:"row"},Ta={class:"col-xs-12 col-sm-4"},va=pa((()=>(0,n._)("label",{class:"selectora",for:"notificationSound","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"Beeps last 14 seconds in turn if checked"},[(0,n._)("i",{class:"bi bi-music-note"})],-1))),wa={class:"ps-4"},fa=pa((()=>(0,n._)("label",{class:"",for:"pointerLine"},"Bridge",-1))),ka={class:"row"},xa={class:"col-xs-12 col-sm-4"},Ca={key:0,class:"text-success"},Pa={key:1,class:"text-success"},Ba={key:2,class:"text-success"},Sa={key:3,class:"text-danger"},Ia={class:"col-xs-12 col-sm-8"};function _a(e,t){const s=(0,n.up)("chat");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",ma,[(0,n._)("div",ga,[e.resignButtonVisible?((0,n.wg)(),(0,n.iD)("button",{key:0,disabled:e.resignButtonDisabled,onClick:t[0]||(t[0]=(...t)=>e.resign&&e.resign(...t)),type:"button",class:"btn btn-primary w-30 float-xs-start float-sm-end"}," Resign ",8,ba)):(0,n.kq)("",!0),e.rematchButtonEnabled?((0,n.wg)(),(0,n.iD)("button",{key:1,onClick:t[1]||(t[1]=(...t)=>e.rematch&&e.rematch(...t)),type:"button",class:"btn btn-primary w-30 float-xs-start float-sm-end"}," Rematch ")):(0,n.kq)("",!0)])]),(0,n._)("div",ya,[(0,n._)("div",Ta,[va,(0,n.wy)((0,n._)("input",{type:"checkbox",id:"notificationSound","onUpdate:modelValue":t[2]||(t[2]=t=>e.gameOptions.soundOn=t)},null,512),[[a.e8,e.gameOptions.soundOn]]),(0,n._)("span",wa,[(0,n.wy)((0,n._)("input",{class:"",type:"checkbox",id:"pointerLine","onUpdate:modelValue":t[3]||(t[3]=t=>e.gameOptions.pointerLine=t)},null,512),[[a.e8,e.gameOptions.pointerLine]]),fa])])]),(0,n._)("div",ka,[(0,n._)("div",xa,[e.playingTurn?((0,n.wg)(),(0,n.iD)("span",Ca,"Playing turn")):e.theTable.playerInTurn?.name===e.userName?((0,n.wg)(),(0,n.iD)("span",Pa," It's your turn "+(0,h.zw)(e.userName)+" > time left:"+(0,h.zw)(this.theTable.secondsLeft),1)):null===e.theTable?.playerInTurn?((0,n.wg)(),(0,n.iD)("span",Ba," Game ended ")):((0,n.wg)(),(0,n.iD)("div",Sa," In turn: "+(0,h.zw)(e.theTable.playerInTurn?.name),1))])]),(0,n._)("div",Ia,[(0,n._)("canvas",{id:"canvas",width:"400",height:"400",style:{border:"1px solid"},class:(0,h.C_)({"bg-secondary":null==e.theTable.playerInTurn})},null,2)]),(0,n.Wm)(s,{id:e.theTable.id},null,8,["id"])],64)}var La=s(9503);const Da=1200,Ra=677,Ma=900,Aa=12,Na=34,Ea=.991,Oa=1/8;let Ga,Ha,Va;var $a=(0,n.aZ)({components:{Chat:ts},name:"PoolTable",mixins:[W,wt,ft],props:["watch"],data(){return{canvas:void 0,balls:[],cueBall:void 0,cue:void 0,poolTable:void 0,gameOptions:{pointerLine:!1,notificationSound:!0},mouseCoordsTemp:void 0,handBall:!1,playingTurn:!1,resultSnapshot:void 0,pocketSelection:!1,selectedPocket:null,turnQueue:{turns:[],blocked:!1}}},watch:{turnQueueLength:{handler(e,t){e>t&&this.consumeTurns()}},mouseEnabled:{handler(e,t){e&&!Va?(console.log("watcher:restartReducerInterval"),this.restartReducerInterval()):e||(this.stopReducerInterval(),this.stopCueInterval(),Va=null)}},timeRunOut:{handler(e,t){e&&(console.log("watcher:stopreducer"),this.stopReducerInterval(),(this.isOngoingGame()&&this.isMyTurnInSnapshot()||!1===this.firstTurnPlayed||void 0===this.firstTurnPlayed)&&this.resign())}}},created(){this.unsubscribe=this.$store.subscribe(((e,t)=>{"rematch"===e.type&&(this.resultSnapshot=null,this.initTable()),"resign"===e.type&&(this.theTable.playerInTurn=null,this.handleGameEnd(),this.clearTurnQueue(),this.draw())}))},mounted(){if(this.initTable(),"1"===this.watch){this.clearTurnQueue(),this.updatePocketedBalls(this.theTable.playerABalls),this.updatePocketedBalls(this.theTable.playerBBalls,!1),this.updateRemainingBallPositions(this.theTable.remainingBalls,this.balls);let e=this.theTable.remainingBalls[this.theTable.remainingBalls.length-1];this.cue.position=e.position,this.unblockQueue(),this.draw()}this.unsubscribeAction=this.$store.subscribeAction(((e,t)=>{if("poolUpdate"===e.type)return this.cue.image.canvasRotationAngle=e.payload.pool.cue.angle,this.cue.angle=e.payload.pool.cue.angle,void this.draw();"poolPlayTurn"!==e.type&&"poolSetHandBall"!==e.type&&"poolSelectPocket"!==e.type&&"poolSetHandBallFail"!==e.type&&"poolGameEnded"!==e.type||(this.resetInstanceVariables(),this.createTableSnapshot(e),!this.isDocumentVisible()&&this.isTimerRestartRequiredForAction(e)&&this.isMe(e.payload.table.playerInTurn.name)&&this.restartReducerInterval(),this.isDocumentVisible&&(this.produceTurns(e),this.draw()))})),new La.u(document.getElementsByClassName("selectora")[0])},computed:{turnQueueLength(){return this.turnQueue.turns.length},mouseEnabled(){const e=this.$store.getters.playerInTurn;if(!e)return this.draw(),!1;if(!this.poolTable)return!1;const t=this.$store.getters.playerInTurn.name===this.userName&&this.poolTable.mouseEnabled;return console.log("computed mouseEnabled:"+t),t},cueVisible(){return this.mouseEnabled},timeRunOut(){return this.theTable.secondsLeft<=0}},beforeUnmount(){this.unsubscribe(),this.unsubscribeAction(),this.clearIntervals(),this.removeMouseListeners(),document.removeEventListener("visibilitychange",this.onVisibilityChange),this.leaveTable()},methods:{resetInstanceVariables(){this.handBall=!1,this.selectedPocket=null,this.pocketSelection=!1,this.cue.force=0,this.cue.position=this.cueBall.position,this.resultSnapshot=null},clearIntervals(){this.stopCueInterval(),clearInterval(Ha),clearInterval(Va)},isTimerRestartRequiredForAction(e){const t="poolPlayTurn"==e.type||"poolSetHandBall"===e.type||"poolSelectPocket"===e.type;return t},consumeTurns(){if(0===this.turnQueue.turns.length){const e=!!this.isMyTurnInStore();return this.poolTable.mouseEnabled=e,void console.log("TurnQueue is empty, mouseEnabled "+this.poolTable.mouseEnabled)}if(this.turnQueue.blocked)return void console.log("TurnQueue is blocked, not consuming");this.turnQueue.blocked=!0;const e=this.turnQueue.turns.splice(0,1)[0];if(console.log("Starting to consume turn "+JSON.stringify(e)),e.shootBall)console.log("shootball"),this.firstTurnPlayed=!0,this.shootBall(e).then((()=>{console.log("shootball done"),this.selectedPocket=null,this.cue.force=0;const e=this.isMyTurnInStore()?0:1500;this.unblockQueue(e),this.playingTurn=!1}));else if(e.setHandBall){this.setHandBall(e);const t=this.isMyTurnInStore()?0:2e3;this.unblockQueue(t)}else null!=e.setSelectedPocket?(this.selectedPocket=e.setSelectedPocket,this.pocketSelection=!1,this.unblockQueue(250)):e.askHandBallPosition?(this.handBall=!0,this.cueBall.image.visible=!0,this.unblockQueue(0)):e.lastTurn?this.handleGameEnd(e):e.askPocketSelection?(this.pocketSelection=!0,this.unblockQueue(0)):e.changePlayer&&this.$store.dispatch("changeTurn",e.nextTurnPlayer).then((()=>{this.unblockQueue(0)}))},unblockQueue(e=0){this.turnQueue.blocked=!1,this.draw(),setTimeout((()=>{this.consumeTurns()}),e)},produceTurns(e){"poolPlayTurn"===e.type?(this.createShootBallTurn(e),"CHANGE_TURN"===e.payload.pool.turnResult?this.createChangePlayerTurn(e):"HANDBALL"===e.payload.pool.turnResult?(this.createChangePlayerTurn(e),this.isMe(e.payload.pool.whoPlayed)||this.createAskHandBallPositionTurn(e)):"ASK_POCKET_SELECTION"===e.payload.pool.turnResult&&(this.isTurnChange(e.payload.table.playerInTurn)&&this.createChangePlayerTurn(e),this.isMe(e.payload.table.playerInTurn.name)&&this.createAskPocketSelectionTurn(e))):"poolSetHandBallFail"===e.type?this.createAskHandBallPositionTurn(e):"poolSetHandBall"===e.type?(this.createPoolSetHandBallTurn(e),"ASK_POCKET_SELECTION"===e.payload.pool.turnResult&&(this.isTurnChange(e.payload.table.playerInTurn)&&this.createChangePlayerTurn(e),this.isMe(e.payload.table.playerInTurn.name)&&this.createAskPocketSelectionTurn(e))):"poolSelectPocket"===e.type?this.createSelectPocketTurn(e):"poolGameEnded"===e.type&&this.createLastTurn(e)},createAskHandBallPositionTurn(e){let t={turnResult:e.payload.pool.turnResult,askHandBallPosition:!0,askPocketSelection:!1,setSelectedPocket:null,setHandBall:!1,lastTurn:!1,whoPlayed:e.payload.pool.whoPlayed};return this.turnQueue.turns.splice(this.turnQueue.turns.length,0,t),console.log("produced: createAskHandBallPositionTurn"+this.turnQueue.turns.length),t},createAskPocketSelectionTurn(e){e.payload.pool.selectedPocket;let t=e.payload.table.playerInTurn,s={changePlayer:!1,turnResult:e.payload.pool.turnResult,askPocketSelection:!0,setSelectedPocket:null,setHandBall:null,nextTurnPlayer:t,lastTurn:!1,whoPlayed:e.payload.pool.whoPlayed};return this.turnQueue.turns.splice(this.turnQueue.turns.length,0,s),console.log("produced: createAskPocketSelectionTurn"+this.turnQueue.turns.length),s},createSelectPocketTurn(e){let t=e.payload.pool.selectedPocket,s={turnResult:e.payload.pool.turnResult,askPocketSelection:!1,setSelectedPocket:t,setHandBall:null,lastTurn:!1,whoPlayed:e.payload.pool.whoPlayed};return this.turnQueue.turns.splice(this.turnQueue.turns.length,0,s),console.log("produced: createSelectPocketTurn"+this.turnQueue.turns.length),s},createLastTurn(e){const t=e.payload.pool.turnResult,s=e.payload.pool.winner.name;let a={askPocketSelection:!1,setSelectedPocket:null,setHandBall:null,lastTurn:!0,winner:s,winReason:t,whoPlayed:e.payload.pool.whoPlayed};return this.turnQueue.turns.splice(this.turnQueue.turns.length,0,a),console.log("produced: createLastTurn"+this.turnQueue.turns.length),a},createChangePlayerTurn(e){let t=e.payload.table.playerInTurn,s={changePlayer:!0,nextTurnPlayer:t,lastTurn:!1,whoPlayed:e.payload.pool.whoPlayed};return this.turnQueue.turns.splice(this.turnQueue.turns.length,0,s),console.log("produced: createChangePlayerTurn"+this.turnQueue.turns.length),s},createShootBallTurn(e){let t=e.payload.pool.cue;t.force=e.payload.pool.cue.force,t.angle=e.payload.pool.cue.angle;let s={shootBall:!0,cue:t,turnResult:e.payload.pool.turnResult,lastTurn:!1,whoPlayed:e.payload.pool.whoPlayed};return this.turnQueue.turns.splice(this.turnQueue.turns.length,0,s),console.log("produced: createShootBallTurn"+this.turnQueue.turns.length),s},createPoolSetHandBallTurn(e){let{...t}=this.cueBall;t.position=e.payload.pool.cueBall.position,t.inPocket=!1,t.image.visible=!0;let s={...this.cue};s.force=0,s.position=t.position;let a={cue:s,cueBall:t,turnResult:e.payload.pool.turnResult,setHandBall:!0,nextTurnPlayer:e.payload.table.playerInTurn,lastTurn:!1,whoPlayed:e.payload.pool.whoPlayed};return this.turnQueue.turns.splice(this.turnQueue.turns.length,0,a),console.log("produced: createPoolSetHandBallTurn"+this.turnQueue.turns.length),a},handleGameEnd(e){if(this.theTable.playerInTurn=null,this.clearTurnQueue(),this.turnQueue.blocked=!0,this.clearIntervals(),this.removeMouseListeners(),this.poolTable.mouseEnabled=!1,e){const t={from:"System",text:e.winner+" won ( "+e.winReason.toLowerCase()+" )"};this.$store.dispatch("chat",t)}this.draw()},setHandBall(e){this.cueBall.position=e.cueBall.position,this.cueBall.inPocket=!1,this.cue.position=this.cueBall.position,this.handBall=!1,this.cue.force=0,this.cueBall.image.visible=!0},createTableSnapshot(e){this.firstTurnPlayed=!0,this.resultSnapshot=e},updateRemainingBallPositions(e,t){e.forEach((e=>{let s=t.find((t=>t.number===e.number));this.updateBallPropertiesWithoutFriction(s,e.position)}))},updateBallPropertiesWithoutFriction(e,t){e.position.x=t.x,e.position.y=t.y,e.velocity.x=0,e.velocity.y=0},updatePocketedBalls(e,t=!0){if(!e||0===e.length)return;let s=t?.12*this.canvas.width:.55*this.canvas.width;for(let a=0;a<e.length;a++){let t=e[a],n=this.balls.find((e=>e.number===t.number));n&&(n.position.x=s+a*n.diameter,n.position.y=.06*this.canvas.height,n.inPocket||(n.image.canvasDimension.x=.8*n.image.canvasDimension.x,n.image.canvasDimension.y=.8*n.image.canvasDimension.y),n.inPocket=!0)}},movePocketedBallToEdgeOfTable(e){if(8===e.number||0===e.number)return;let t=this.resultSnapshot.payload.table.playerABalls.findIndex((t=>t.number===e.number)),s=.12*this.canvas.width;-1===t&&(t=this.resultSnapshot.payload.table.playerBBalls.findIndex((t=>t.number===e.number))+1,s=.55*this.canvas.width),e.position.x=s+t*e.diameter,e.position.y=.06*this.canvas.height},putBallInMiddleOfPocket(e,t){e.inPocket||(e.velocity.x=0,e.velocity.y=0,t&&(e.position.x=t.center.x,e.position.y=t.center.y),e.inPocket=!0,0!==e.number&&8!==e.number&&(e.image.canvasDimension.x=.8*e.image.canvasDimension.x,e.image.canvasDimension.y=.8*e.image.canvasDimension.y))},draw(){this.isDocumentVisible()&&requestAnimationFrame(this.repaintAll)},repaintComponent(e){const t=e.image;e.image.visible&&(this.renderingContext.translate(e.position.x,e.position.y),t.canvasRotationAngle&&this.renderingContext.rotate(t.canvasRotationAngle),t.canvasDestination||(t.canvasDestination={x:0,y:0}),this.gameOptions&&this.gameOptions.pointerLine&&e.hasOwnProperty("force")&&(this.renderingContext.beginPath(),this.renderingContext.moveTo(-200,0),this.renderingContext.lineTo(200,0),this.renderingContext.stroke(),this.renderingContext.beginPath(),this.renderingContext.moveTo(0,-200),this.renderingContext.lineTo(0,200),this.renderingContext.stroke()),!this.isMyTurnInStore()&&e.hasOwnProperty("force")?this.renderingContext.drawImage(t.image,1430,0,100,22,t.canvasDestination.x+825,t.canvasDestination.y,88,10):this.renderingContext.drawImage(t.image,0,0,t.realDimension.x,t.realDimension.y,t.canvasDestination.x,t.canvasDestination.y,t.canvasDimension.x,t.canvasDimension.y),this.renderingContext.resetTransform())},repaintAll(){this.renderingContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.repaintComponent(this.poolTable),this.repaintComponent(this.cueBall);for(let e=0;e<this.balls.length;e++)this.repaintComponent(this.balls[e]);if(this.isOngoingGame()||this.repaintGameEnd(),this.repaintNames(),this.handBall||this.playingTurn||this.repaintComponent(this.cue),this.handBall&&this.isMyTurnInStore()&&(this.renderingContext.font="bolder 16px Arial",this.renderingContext.fillText("Set handball position",400,35)),this.pocketSelection&&this.isMyTurnInStore()){const e=null===this.selectedPocket?0:this.selectedPocket;this.repaintPocketSelection(e),this.renderingContext.font="bolder 16px Arial",this.renderingContext.fillText("Click to select pocket",400,35)}else null!==this.selectedPocket&&this.repaintPocketSelection(this.selectedPocket);this.renderingContext.fillStyle="black"},repaintGameEnd(){this.renderingContext.globalAlpha=.4,this.renderingContext.fillStyle="gray",this.renderingContext.fillRect(0,0,this.canvas.width,this.canvas.height)},initTable(){this.balls=[],this.turnQueue={turns:[],blocked:!1};let e=window.innerWidth,t=window.innerHeight;this.canvas=document.getElementById("canvas"),this.renderingContext=this.canvas.getContext("2d",{alpha:!1});let s=e,a=t;s=Da,a=Ra,this.canvas.height=a,this.canvas.width=s,document.addEventListener("visibilitychange",this.onVisibilityChange);let n={x:Da,y:Ra},i={image:document.getElementById("tableImg"),canvasDimension:n,realDimension:{x:4551,y:2570},canvasRotationAngle:{x:0,y:0},visible:!0};this.poolTable={image:i,position:{x:0,y:0},mouseEnabled:!1};const o={a:79,b:118,c:572},r={a:79,b:644,c:1090},l={a:1122,b:118,c:560},h={a:600,b:644,c:1090},c={a:600,b:118,c:572},u={a:80,b:118,c:560};this.poolTable.pockets=[],this.poolTable.topLeftPart=o,this.poolTable.topRightPart=r,this.poolTable.rightPart=l,this.poolTable.bottomRightPart=h,this.poolTable.bottomLeftPart=c,this.poolTable.leftPart=u;const d={center:{x:65,y:61},radius:32,pathwayLeft:{top:{x:54,y:93},bottom:{x:80,y:118}},pathwayRight:{top:{x:96,y:56},bottom:{x:117,y:77}}},p={center:{x:607,y:49},radius:28,pathwayLeft:{top:{x:580,y:56},bottom:{x:571,y:79}},pathwayRight:{top:{x:635,y:56},bottom:{x:644,y:79}}},m={center:{x:1144,y:61},radius:32,pathwayLeft:{top:{x:1112,y:56},bottom:{x:1089,y:79}},pathwayRight:{top:{x:1144,y:93},bottom:{x:1122,y:118}}},g={center:{x:1144,y:614},radius:32,pathwayLeft:{top:{x:1091,y:600},bottom:{x:1112,y:620}},pathwayRight:{top:{x:1122,y:562},bottom:{x:1142,y:580}}},b={center:{x:607,y:628},radius:28,pathwayLeft:{top:{x:571,y:600},bottom:{x:580,y:620}},pathwayRight:{top:{x:644,y:600},bottom:{x:635,y:620}}},y={center:{x:65,y:614},radius:32,pathwayLeft:{top:{x:80,y:558},bottom:{x:54,y:584}},pathwayRight:{top:{x:118,y:600},bottom:{x:98,y:620}}};this.poolTable.pockets.push(d),this.poolTable.pockets.push(p),this.poolTable.pockets.push(m),this.poolTable.pockets.push(g),this.poolTable.pockets.push(b),this.poolTable.pockets.push(y),this.poolTable.topMiddlePocket=p,this.poolTable.topRightPocket=m,this.poolTable.bottomRightPocket=g,this.poolTable.bottomMiddlePocket=b,this.poolTable.bottomLeftPocket=y;const T={x:Na,y:Na};let v={image:document.getElementById("0"),canvasDimension:T,realDimension:{x:141,y:141},canvasRotationAngle:{x:0,y:0},canvasDestination:{x:-Na/2,y:-Na/2},visible:!0};this.cueBall={image:v,diameter:Na,radius:Na/2,position:{x:1030,y:150},number:0,color:"white",velocity:{x:0,y:0}};let w={x:Ma,y:Aa},f={image:document.getElementById("cue3Img"),canvasDimension:w,realDimension:{x:1508,y:22},canvasDestination:{x:-w.x-Na,y:-w.y/2},canvasRotationAngle:{x:0,y:0},visible:!0};this.isPlayerInTurn(this.userName)&&(this.handBall=!0,this.poolTable.mouseEnabled=!0);let k={x:this.cueBall.position.x,y:this.cueBall.position.y},x=0;this.cue={position:k,image:f,force:x,angle:0};for(let C=1;C<16;C++){let e=this.createBall(C,this.cueBall.diameter);this.balls.push(e)}this.balls.push(this.cueBall),"1"!==this.watch&&(this.removeMouseListeners(),this.addMouseListeners()),this.draw()},isDocumentVisible(){return"visible"===document.visibilityState},onVisibilityChange(){this.isDocumentVisible()?(this.stopCueInterval(),clearInterval(Ha),this.createTableFromSnapShot(),this.clearTurnQueue(),this.unblockQueue(0),this.draw()):(this.turnQueue.blocked=!0,this.stopCueInterval(),clearInterval(Ha))},clearTurnQueue(){this.turnQueue.turns.splice(0,this.turnQueue.turns.length)},createTableFromSnapShot(){if(!this.resultSnapshot)return;let e=this.resultSnapshot.payload.table,t=this.resultSnapshot.payload.pool;this.playingTurn=!1,this.updatePocketedBalls(e.playerABalls),this.updatePocketedBalls(e.playerBBalls,!1),this.updateRemainingBallPositions(e.remainingBalls,this.balls),this.cueBall.position=t.cueBall.position,this.cueBall.velocity.x=0,this.cueBall.velocity.y=0;let s=e.playerInTurn;if(this.changeTurnIfRequired(s),t.winner){console.log("winner from snapshot"+t.winner.name);const e=t.winner.name,s=t.turnResult;let a={askPocketSelection:!1,setSelectedPocket:null,setHandBall:null,lastTurn:!0,winner:e,winReason:s,whoPlayed:t.whoPlayed};this.handleGameEnd(a)}else this.isMyTurnInStore()&&(this.poolTable.mouseEnabled=!0);"HANDBALL"===t.turnResult&&this.isMyTurnInStore()?this.handBall=!0:"ASK_POCKET_SELECTION"===t.turnResult&&this.isMyTurnInStore()&&(this.pocketSelection=!0),requestAnimationFrame(this.repaintAll)},isTableTopBoundry(e){return e.position.x>=this.poolTable.topLeftPart.b&&e.position.x<=this.poolTable.topLeftPart.c&&e.position.y-this.cueBall.radius<=this.poolTable.topLeftPart.a||e.position.x>=this.poolTable.topRightPart.b&&e.position.x<=this.poolTable.topRightPart.c&&e.position.y-this.cueBall.radius<=this.poolTable.topRightPart.a},isTableLeftBoundry(e){return e.position.x<=this.poolTable.leftPart.a+this.cueBall.radius&&e.position.y>=this.poolTable.leftPart.b&&e.position.y<=this.poolTable.leftPart.c},isTableRightBoundry(e){return e.position.x>=this.poolTable.rightPart.a-this.cueBall.radius&&e.position.y>=this.poolTable.rightPart.b&&e.position.y<=this.poolTable.rightPart.c},isTableBottomBoundry(e){return e.position.x>=this.poolTable.bottomLeftPart.b&&e.position.x<=this.poolTable.bottomLeftPart.c&&e.position.y+this.cueBall.radius>=this.poolTable.bottomLeftPart.a||e.position.x>=this.poolTable.bottomRightPart.b&&e.position.x<=this.poolTable.bottomRightPart.c&&e.position.y+this.cueBall.radius>=this.poolTable.bottomRightPart.a},restartReducerInterval(e){Va&&this.stopReducerInterval(),this.theTable.secondsLeft=this.getTimeControls()[this.theTable.timeControlIndex].seconds,Va=setInterval((()=>{this.theTable.secondsLeft--,this.gameOptions.soundOn&&this.theTable.secondsLeft<15&&this.playNotificationSound()}),1e3)},startCueInterval(){console.log("called startCueInterval"),Ga&&(console.log("called startCueInterval stopping first"),this.stopInterval()),Ga=setInterval(this.updateCueForce,50),console.log("called startCueInterval startin really"+Ga)},stopCueInterval(){console.log("stopping cueForceInterval "+Ga),Ga=clearInterval(Ga),console.log("stopped cueForceInterval"+Ga)},stopReducerInterval(){Va=clearInterval(Va),console.log("stoppedReducerInterval"+Va)},createBall(e,t){const s={x:t,y:t};let a={x:.65*this.canvas.width+.9*t*this.calculateRackColumn(e),y:this.canvas.height/2+.5*t*this.calculateRackRow(e)},n={image:document.getElementById(e.toString()),canvasDimension:s,realDimension:{x:141,y:141},canvasRotationAngle:{x:0,y:0},canvasDestination:{x:-t/2,y:-t/2},visible:!0};return{image:n,diameter:t,radius:t/2,position:a,number:e,color:this.calculateBallColor(e),velocity:{x:0,y:0}}},addMouseListeners(){this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.onpointerdown=this.handleMouseDown,this.canvas.onpointerup=this.handleMouseUp,this.canvas.onpointermove=this.handleMouseMove,this.canvas.addEventListener("pointerdown",this.handleMouseDown,!1),this.canvas.addEventListener("pointerup",this.handleMouseUp,!1),this.canvas.addEventListener("pointermove",this.handleMouseMove,!1),this.canvas.addEventListener("contextmenu",(e=>e.preventDefault()))},removeMouseListeners(){this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("contextmenu",(e=>e.preventDefault())),this.canvas.removeEventListener("pointerdown",this.handleMouseUp),this.canvas.removeEventListener("pointerup",this.handleMouseUp),this.canvas.removeEventListener("pointermove",this.handleMouseUp)},handleMouseDown(e){2!==e.button&&this.poolTable.mouseEnabled&&(this.pocketSelection||this.poolTable.mouseEnabled&&!this.handBall&&(this.cue.force=0,console.log("cueForce interval:"+Ga),Ga||this.startCueInterval()))},handleMouseUp(e){if(this.poolTable.mouseEnabled){if(this.stopCueInterval(),this.pocketSelection)return this.poolTable.mouseEnabled=!1,void this.sendPocketSelection(this.selectedPocket);this.handBall?(this.cueBall.position.x=e.offsetX,this.cueBall.position.y=e.offsetY,this.hb(e.offsetX,e.offsetY,this.canvas)):this.handBall||(this.poolTable.mouseEnabled=!1,this.stopReducerInterval(),this.sendTurn(this.cue,this.cueBall,this.canvas)),this.poolTable.mouseEnabled=!1}},isMyTurnInSnapshot(){return!!this.resultSnapshot&&this.resultSnapshot.payload.table.playerInTurn.name===this.userName},isHandBallPositionAllowed(){if(!this.firstTurnPlayed&&this.mouseCoordsTemp.x>.25*this.canvas.width)return!1;if(!(this.mouseCoordsTemp.x>this.poolTable.leftPart.a+this.cueBall.radius&&this.mouseCoordsTemp.x<this.poolTable.rightPart.a-this.cueBall.radius))return!1;if(!(this.mouseCoordsTemp.y>this.poolTable.topLeftPart.a+this.cueBall.radius&&this.mouseCoordsTemp.y<this.poolTable.bottomRightPart.a-this.cueBall.radius))return!1;for(let e=0;e<this.balls.length;e++){const t=this.balls[e];if(0===t.number)continue;let s=t.position.x-this.cueBall.position.x,a=t.position.y-this.cueBall.position.y;if(!(Math.abs(s)>t.diameter)&&!(Math.abs(a)>t.diameter))return!1}return!0},handleMouseMove(e){if(this.poolTable.mouseEnabled){if(this.mouseCoordsTemp={x:e.offsetX,y:e.offsetY},this.pocketSelection)return this.selectedPocket=this.getClosestPocket(e),void this.draw();this.handBall?(this.cueBall.position.x=e.offsetX,this.cueBall.position.y=e.offsetY,setTimeout((()=>{this.isHandBallPositionAllowed(e)?this.cueBall.image.visible=!0:this.cueBall.image.visible=!1,this.draw()}),10)):(this.cue.position.x=this.cueBall.position.x,this.cue.position.y=this.cueBall.position.y,this.mousePoint={x:e.offsetX,y:e.offsetY},this.isMyTurnInStore()&&setTimeout((()=>{this.updateCueAngle(e),this.draw()}),150))}},handleAfterAnimation(){return new Promise((e=>{this.isMyTurnInStore()&&null!==this.theTable.playerInTurn&&(this.cue.force=0),this.draw(),e("resolve after animation")}))},shootBall(e){return new Promise((t=>{this.cue.force<10&&(this.cue.force=10);let s={x:-Ma-Na/2,y:-Aa/2};this.cue.force=e.cue.force,this.cue.angle=e.cue.angle,this.cue.image.canvasRotationAngle=e.cue.angle,this.cue.image.canvasDestination=s,this.cueBall.velocity={x:this.cue.force*Math.cos(this.cue.image.canvasRotationAngle),y:this.cue.force*Math.sin(this.cue.image.canvasRotationAngle)},this.collideCueWithCueBall().then((()=>{this.playingTurn=!0,this.handleCollisions().then((()=>{this.handleAfterAnimation().then((()=>{t("animations done")}))}))}))}))},collideCueWithCueBall(){return new Promise((e=>{this.cue.position=this.cueBall.position,setTimeout((()=>{this.draw(),e("Cue movement done")}),145)}))},handleCollisions(){return new Promise((e=>{Ha=setInterval((()=>{this.updateBallProperties(),this.handleBallCollisions(),this.draw(),this.isAnyBallMoving()||(clearInterval(Ha),e("collisions checked"))}),25)}))},updateBallProperties(){for(let e=0;e<this.balls.length;e++){let t=this.balls[e];t.inPocket?t.velocity={x:0,y:0}:(t.position.x+=t.velocity.x*Oa,t.position.y+=t.velocity.y*Oa,t.velocity.x*=Ea,t.velocity.y*=Ea)}},checkIfGoesToPocket(e){let t=this.poolTable.pockets[0],s=Math.pow(e.position.x-t.center.x,2)+Math.pow(e.position.y-t.center.y,2)<=Math.pow(t.radius,2);return s?t:(t=this.poolTable.topMiddlePocket,s=Math.pow(e.position.x-t.center.x,2)+Math.pow(e.position.y-t.center.y,2)<=Math.pow(t.radius,2),s?t:(t=this.poolTable.topRightPocket,s=Math.pow(e.position.x-t.center.x,2)+Math.pow(e.position.y-t.center.y,2)<=Math.pow(t.radius,2),s?t:(t=this.poolTable.bottomRightPocket,s=Math.pow(e.position.x-t.center.x,2)+Math.pow(e.position.y-t.center.y,2)<=Math.pow(t.radius,2),s?t:(t=this.poolTable.bottomMiddlePocket,s=Math.pow(e.position.x-t.center.x,2)+Math.pow(e.position.y-t.center.y,2)<=Math.pow(t.radius,2),s?t:(t=this.poolTable.bottomLeftPocket,s=Math.pow(e.position.x-t.center.x,2)+Math.pow(e.position.y-t.center.y,2)<=Math.pow(t.radius,2),s?t:void 0)))))},handleBallCollisions(){for(let e=0;e<this.balls.length;e++){const t=this.balls[e];this.isMoving(t)&&!t.inPocket&&this.checkAndHandleTableCollision(t);for(let s=e+1;s<this.balls.length;s++){const t=this.balls[s],a=this.balls[e];t.inPocket||a.inPocket||(this.isMoving(t)||this.isMoving(a))&&this.checkAndHandleCollision(a,t)}}},checkAndHandleCollision(e,t){let s=this.subtractVectors(e.position,t.position);const a=this.calculateLength(s);if(a>this.cueBall.diameter)return;const n=this.multiplyVector(s,(this.cueBall.diameter-a)/a);e.position.x+=.5*n.x,e.position.y+=.5*n.y,t.position.x-=.5*n.x,t.position.y-=.5*n.y;const i=1/a,o=this.multiplyVector(s,i),r={x:-o.y,y:o.x},l=this.dotProduct(o,e.velocity),h=this.dotProduct(r,e.velocity),c=this.dotProduct(o,t.velocity),u=this.dotProduct(r,t.velocity);let d=c,p=l;d={x:o.x*d,y:o.y*d};const m={x:r.x*h,y:r.y*h};p={x:o.x*p,y:o.y*p};const g={x:r.x*u,y:r.y*u};e.velocity={x:d.x+m.x,y:d.y+m.y},t.velocity={x:p.x+g.x,y:p.y+g.y}},isMoving(e){return!!e&&(0!==e.velocity.x||0!==e.velocity.y)},checkAndHandleTableCollision(e){if(!this.isBallInMiddleArea(e))if(this.isTableTopBoundry(e))e.velocity.y=Math.abs(e.velocity.y);else if(this.isTableBottomBoundry(e))e.velocity.y=-Math.abs(e.velocity.y);else if(this.isTableLeftBoundry(e))e.velocity.x=Math.abs(e.velocity.x);else if(this.isTableRightBoundry(e))e.velocity.x=-Math.abs(e.velocity.x);else if(this.checkAndHandlePocketPathwayCollisions(e));else{const t=this.checkIfGoesToPocket(e);if(t)return this.putBallInMiddleOfPocket(e,t),void setTimeout((()=>{this.movePocketedBallToEdgeOfTable(e),this.draw()}),1500)}},updatePositionAndVelocity(e){e.position.x+=e.velocity.x*Oa,e.position.y+=e.velocity.y*Oa,e.velocity.x*=Ea,e.velocity.y*=Ea},checkAndHandlePocketPathwayCollisions(e){for(let t=0;t<this.poolTable.pockets.length;t++){const s=this.poolTable.pockets[t];if(this.isPathwayBorderCollision(s.pathwayRight,e,t)){let t=this.calculateBallVelocityOnPathwayBorderCollision(s.pathwayRight,e);return e.velocity=t,!0}if(this.isPathwayBorderCollision(s.pathwayLeft,e,t)){let t=this.calculateBallVelocityOnPathwayBorderCollision(s.pathwayLeft,e);return e.velocity=t,!0}}return!1},calculateBallVelocityOnPathwayBorderCollision(e,t){let s=this.subtractVectors(e.bottom,e.top);const a=this.calculateLength(s),n=1/a,i=this.multiplyVector(s,n);let o=2*this.dotProduct(i,t.velocity),r=this.multiplyVector(i,o),l=this.subtractVectors(r,t.velocity);return l},isPathwayBorderCollision(e,t){if(this.isBallInMiddleArea(t))return!1;const s=e.top,a=e.bottom,n=t.position,i=this.subtractVectors(n,s),o=this.subtractVectors(a,s),r=this.addVectors(this.projectVectorOnVector(i,o),s),l=this.subtractVectors(r,s),h=Math.abs(o.x)>Math.abs(o.y)?l.x/o.x:l.y/o.y;let c;return h<=0?c=Math.sqrt(this.hypot2(n,s)):h>=1&&(c=Math.sqrt(this.hypot2(n,a))),c||(c=Math.sqrt(this.hypot2(n,r))),c<=t.radius},isBallInMiddleArea(e){const t={x:125,y:130},s={x:1072,y:550},a=this.subtractVectors(e.position,t),n=this.subtractVectors(s,e.position);if(a.x>0&&a.y>0)return n.x>0&&n.y>0},hypot2(e,t){return this.dotProduct(this.subtractVectors(e,t),this.subtractVectors(e,t))},projectVectorOnVector(e,t){const s=this.dotProduct(e,t)/this.dotProduct(t,t);return{x:s*t.x,y:s*t.y}},calculateLength(e){const t=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));return t},calculateVectorLength(e){const t=Math.sqrt(Math.pow(e.velocity.x,2)+Math.pow(e.velocity.y,2));return t<5&&(e.velocity={x:0,y:0}),e},multiplyVector(e,t){return{x:e.x*t,y:e.y*t}},addVectors(e,t){return{x:e.x+t.x,y:e.y+t.y}},subtractVectors(e,t){return{x:e.x-t.x,y:e.y-t.y}},dotProduct(e,t){return e.x*t.x+e.y*t.y},isAnyBallMoving(){for(let e=0;e<this.balls.length;e++){let t=this.balls[e];if(this.calculateVectorLength(t),0!==t.velocity.x||0!==t.velocity.y)return!0}return!1},updateCueAngle(e){let t=this.mousePoint.y-this.cueBall.position.y,s=this.mousePoint.x-this.cueBall.position.x;const a=Math.atan2(t,s);this.cue.angle=a,this.cue.image.canvasRotationAngle=a,this.t(this.sp,1e3,this.cue,this.cueBall,this.canvas)},updateCueForce(){this.cue.force+=10,this.cue.image.canvasDestination.x-=5,this.draw(),this.cue.force>=250&&(this.stopCueInterval(),this.stopReducerInterval(),this.poolTable.mouseEnabled=!1,this.sendTurn(this.cue,this.cueBall,this.canvas))},updatePointerLine(e){if(!e)return;const t=this.cueBall;this.pointerLine={fromX:t.position.x+t.diameter/2,fromY:t.position.y+t.diameter/2,toX:e.offsetX,toY:e.offsetY}},calculateBallColor(e){return 8===e?"black":e%2===0?"red":"yellow"},calculateRackRow(e){return 1===e||8===e||13==e?0:3===e||15===e?1:10===e||2===e||15===e?-1:4===e||12===e?-2:6===e||14===e?2:7===e?3:9===e?-3:5===e?-4:11===e?4:-4},calculateRackColumn(e){return 1===e?1:10===e||3===e?2:4===e||8===e||14===e?3:7===e||9===e||2===e||15===e?4:5},repaintTableParts(e){this.renderingContext.moveTo(this.poolTable.leftPart.a,this.poolTable.leftPart.b),this.renderingContext.lineTo(this.poolTable.leftPart.a,this.poolTable.leftPart.c),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.moveTo(this.poolTable.topLeftPart.b,this.poolTable.topLeftPart.a),this.renderingContext.lineTo(this.poolTable.topLeftPart.c,this.poolTable.topLeftPart.a),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.moveTo(this.poolTable.topRightPart.b,this.poolTable.topRightPart.a),this.renderingContext.lineTo(this.poolTable.topRightPart.c,this.poolTable.topRightPart.a),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.moveTo(this.poolTable.rightPart.a,this.poolTable.rightPart.b),this.renderingContext.lineTo(this.poolTable.rightPart.a,this.poolTable.rightPart.c),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.moveTo(this.poolTable.bottomRightPart.b,this.poolTable.bottomRightPart.a),this.renderingContext.lineTo(this.poolTable.bottomRightPart.c,this.poolTable.bottomRightPart.a),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.moveTo(this.poolTable.bottomLeftPart.b,this.poolTable.bottomLeftPart.a),this.renderingContext.lineTo(this.poolTable.bottomLeftPart.c,this.poolTable.bottomLeftPart.a),this.renderingContext.stroke(),this.renderingContext.closePath()},repaintPockets(){this.renderingContext.fillStyle="red",this.renderingContext.lineWidth=1,this.renderingContext.beginPath(),this.renderingContext.arc(this.poolTable.pockets[0].center.x,this.poolTable.pockets[0].center.y,this.poolTable.pockets[0].radius,0,2*Math.PI),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.fill(),this.renderingContext.beginPath(),this.renderingContext.arc(this.poolTable.topMiddlePocket.center.x,this.poolTable.topMiddlePocket.center.y,this.poolTable.topMiddlePocket.radius,0,2*Math.PI),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.fill(),this.renderingContext.beginPath(),this.renderingContext.arc(this.poolTable.topRightPocket.center.x,this.poolTable.topRightPocket.center.y,this.poolTable.topRightPocket.radius,0,2*Math.PI),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.fill(),this.renderingContext.beginPath(),this.renderingContext.arc(this.poolTable.bottomRightPocket.center.x,this.poolTable.bottomRightPocket.center.y,this.poolTable.bottomRightPocket.radius,0,2*Math.PI),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.fill(),this.renderingContext.beginPath(),this.renderingContext.arc(this.poolTable.bottomMiddlePocket.center.x,this.poolTable.bottomMiddlePocket.center.y,this.poolTable.bottomMiddlePocket.radius,0,2*Math.PI),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.fill(),this.renderingContext.beginPath(),this.renderingContext.arc(this.poolTable.bottomLeftPocket.center.x,this.poolTable.bottomLeftPocket.center.y,this.poolTable.bottomLeftPocket.radius,0,2*Math.PI),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.fill()},repaintPathways(){this.mouseCoordsTemp&&(this.renderingContext.fillStyle="black",this.renderingContext.fillText("Mouse: x:"+this.mouseCoordsTemp.x+"  y:"+this.mouseCoordsTemp.y,150,50),this.renderingContext.fillText("Ball:  x:"+this.cueBall.position.x+"  y:"+this.cueBall.position.y,150,40));for(let e=0;e<6;e++){let t=this.poolTable.pockets[e].pathwayLeft;if(!t)break;this.renderingContext.moveTo(t.top.x,t.top.y),this.renderingContext.lineTo(t.bottom.x,t.bottom.y),this.renderingContext.stroke(),this.renderingContext.closePath(),t=this.poolTable.pockets[e].pathwayRight,this.renderingContext.moveTo(t.top.x,t.top.y),this.renderingContext.lineTo(t.bottom.x,t.bottom.y),this.renderingContext.stroke(),this.renderingContext.closePath()}},repaintNames(){this.renderingContext.font="bolder 16px Arial",this.renderingContext.fillStyle="black",this.renderingContext.fillText(this.theTable.playerA.name,.1*this.canvas.width,20),this.renderingContext.fillText(this.theTable.playerB.name,.55*this.canvas.width,20)},repaintPocketSelection(e){this.renderingContext.fillStyle="blue",this.renderingContext.lineWidth=1,this.renderingContext.beginPath(),this.renderingContext.arc(this.poolTable.pockets[e].center.x,this.poolTable.pockets[e].center.y,this.poolTable.pockets[e].radius,0,2*Math.PI),this.renderingContext.stroke(),this.renderingContext.closePath(),this.renderingContext.fill()}}});const Ua=(0,Y.Z)($a,[["render",_a],["__scopeId","data-v-a912993e"]]);var qa=Ua;const za={class:"row mb-3 mt-2"},Wa=(0,n.uE)('<div class="col"><span class="fw-bold"><h3>Terms and conditions 24.02.2022</h3></span><p class=""><span class="fw-bold">General</span><br> Site is under construction and can change/reset data without informing. At the moment you can play eightball, tic-tac-toe and connect4 games. On some occasions IP-address of the client is logged. <br></p><p class=""><span class="fw-bold">Cookies</span><br> This site does not use cookies to store information. Instead it uses browser&#39;s session storage to store login token.<br> With basic browser settings token is removed after closing or after using logging out functionality. <br></p><p class=""><span class="fw-bold">Browsers</span><br> Recommended browsers are latest versions of Firefox, Chrome and Edge. <br></p><p class=""><span class="fw-bold">Bugs </span><br> No bounties are available for bugs. But if you track them and find anything please use the feedback form for notifying. </p><p class=""><span class="fw-bold">Disclaimer</span><br> You use this site at your own risk.<br> There is no guarantee for this website to work error free. The author of this site is not liable for any damage what could be caused by using this website.<br></p></div>',1),Fa=[Wa];function Ya(e,t,s,a,i,o){return(0,n.wg)(),(0,n.iD)("div",za,Fa)}var Qa=(0,n.aZ)({name:"Info",data(){return{messages:null,message:{text:""}}},computed:{messageExist(){return this.message.text.length>0}},created(){},methods:{sendMessage(){let e=this.message.text.trim();e.length<1||e.length}}});const Za=(0,Y.Z)(Qa,[["render",Ya]]);var Ja=Za;const Xa={class:"row"},ja=(0,n.uE)('<div class="col-xs-12 col-sm-12"><span class="fw-bold"> Eight ball briefly: </span><p> 1. Starting player sets the handball on the left side of the line by clicking the position with mouse.<br> 2. At first the table is open =&gt; players choose either solids or stripes to play with.<br> 3. Aim with mouse, put cursor near the ball you want to hit. <br> Holding mouse button down gives force to the cue, until maxed out or releasing the button.<br> 4. Last ball to put into a pocket is eight ball. A pocket selection must be done before pocketing.<br> 5. Player wins if eight ball is hit first and it goes to the selected pocket while cue ball stays on the table.<br> 6. Other than starting handball can be placed freely at the table unless it is overlapping other ball. </p><p><span class="fw-bold"> Mobile clients </span> It is possible to play the games also with mobile client. <p> Canvas, where the games are playd, is not responsive. However it is possible to zoom in and out. Playing can be easier if device supports horizontal layout by turning the device.<br> EightBall: Mobile device uses browser&#39;s pointer events which are not supported by all devices. <br> Both aiming and cue force loading happens by holding finger (or similar) on the screen at wanted point. <br> Zooming in and out _should_ be also possible before aiming has started. </p></p></div>',1),Ka=[ja];function en(e,t,s,a,i,o){return(0,n.wg)(),(0,n.iD)("div",Xa,Ka)}var tn=(0,n.aZ)({name:"Instructions",mixins:[W],data(){},computed:{},created(){},methods:{}});const sn=(0,Y.Z)(tn,[["render",en]]);var an=sn;const nn=e=>((0,n.dD)("data-v-b491747e"),e=e(),(0,n.Cn)(),e),on={key:0,class:"row"},rn=nn((()=>(0,n._)("div",{class:"col fw-bold"}," Have some feedback? Are games not working? Have improvement ideas? ",-1))),ln={class:"row mt-4"},hn={class:"col"},cn=["disabled"],un=nn((()=>(0,n._)("div",{class:"row"},[(0,n._)("div",{class:"col"},[(0,n.Uk)(" Known issues for 8-ball game: "),(0,n._)("br"),(0,n.Uk)(" 1. On some occasions the ball which collides with cue ball can go/move to an unexpected or even opposite direction than what can be expected. "),(0,n._)("br"),(0,n.Uk)(" 2. A ball can be wobbly when it goes along the pocket pathway. "),(0,n._)("br"),(0,n._)("br"),(0,n.Uk)(" In these cases going to another browser window/tab and coming back refreshes the browser to the latest server level."),(0,n._)("br")])],-1))),dn={key:0,class:"row d-inline-flex p-2 alert-danger"},pn={key:1,class:"row spinner-border",role:"status"},mn=nn((()=>(0,n._)("span",{class:"sr-only"},null,-1))),gn=[mn],bn={key:2,class:"row mt-4 alert alert-success"},yn=nn((()=>(0,n._)("div",{class:"col"}," Thanks! ",-1))),Tn=[yn];function vn(e,t,s,i,o,r){return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.showThanks||e.loadingData?e.loadingData?((0,n.wg)(),(0,n.iD)("div",pn,gn)):(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",on,[rn,(0,n._)("div",ln,[(0,n._)("div",hn,[(0,n._)("div",null,[(0,n.wy)((0,n._)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.message=t),maxlength:"400",class:"form-control",rows:"3"}," ",512),[[a.nr,e.message]]),(0,n._)("button",{disabled:!e.sendButtonEnabled,onClick:t[1]||(t[1]=(...t)=>e.send&&e.send(...t)),class:"btn btn-primary"}," Send feedback ",8,cn)])])]),un,e.showError?((0,n.wg)(),(0,n.iD)("div",dn," Error occured! ")):(0,n.kq)("",!0)])),e.showThanks?((0,n.wg)(),(0,n.iD)("div",bn,Tn)):(0,n.kq)("",!0)],64)}var wn=(0,n.aZ)({name:"Feedback",data(){return{message:"",error:!1,success:!1,loading:!1}},computed:{sendButtonEnabled(){const e=this.message.trim();return e.length>4},showError(){return this.error},showThanks(){return this.success},loadingData(){return this.loading}},methods:{send(){console.log("http://35.217.7.146");const e="http://35.217.7.146/portal/api/feedback",t={method:"POST",headers:{"Content-Type":"application/json",Authorization:null},body:JSON.stringify(this.message)};this.loading=!0,fetch(e,t).then((e=>{if(200!==e.status)return Promise.reject("error in feedback")})).then((e=>{this.error=!1,this.success=!0,this.message=""}),(e=>{this.error=!0,this.success=!1})).finally((()=>{this.loading=!1}))}},created(){}});const fn=(0,Y.Z)(wn,[["render",vn],["__scopeId","data-v-b491747e"]]);var kn=fn;const xn={key:0,class:"row"},Cn=(0,n._)("div",{class:"col"},[(0,n._)("h3",null," Create nickname")],-1),Pn=(0,n._)("div",{class:"row"},[(0,n._)("div",{class:"col m-2"}," Nickname is optional to play the game. Nickname must be at least 2 chars and must not contain special characters. Password must be at minimum 8 characters. ")],-1),Bn=[Cn,Pn],Sn={key:1,class:"row"},In={class:"col m-2"},_n=(0,n.Uk)(" * Nickname "),Ln={key:2,class:"row"},Dn={class:"col"},Rn=(0,n.Uk)(" * Password "),Mn={key:3,class:"row"},An={class:"col"},Nn=["disabled"],En={key:0,class:"text-danger"},On={key:0,class:"d-inline-flex p-2 alert-danger",role:"alert"},Gn={key:1,class:"d-inline-flex p-2 alert-danger",role:"alert"},Hn={key:4,class:"row"},Vn={class:"col alert alert-success"},$n=(0,n.Uk)(" login ");function Un(e,t,s,i,o,r){const l=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.registerDone?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",xn,Bn)),e.registerDone?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",Sn,[(0,n._)("div",In,[_n,(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.usrNameTemp=t),class:"p-3",id:"username",type:"text",name:"username",pattern:"\\\\S(.\\\\*\\\\S)\\\\?\\\\*",title:"This field is required",size:"40",maxlength:"15",autocomplete:"off"},null,512),[[a.nr,e.usrNameTemp]])])])),e.registerDone?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",Ln,[(0,n._)("div",Dn,[Rn,(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.usrPwTemp=t),class:"p-3",id:"pw",name:"pw",type:"password",minlength:"8",size:"40",maxlength:"150",autocomplete:"off"},null,512),[[a.nr,e.usrPwTemp]])])])),e.registerDone?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",Mn,[(0,n._)("div",An,[(0,n._)("button",{onClick:t[2]||(t[2]=(...t)=>e.registrate&&e.registrate(...t)),class:"btn btn-primary",disabled:e.isRegistrateButtonDisabled}," Registrate ",8,Nn),e.registrationDataOk?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("span",En," Type (better) password"))]),e.errorInRegistration?((0,n.wg)(),(0,n.iD)("div",On," Registration error occured! Nickname minimum 2 characters and password minimum 8 characters. Try another nickname. ")):(0,n.kq)("",!0),e.errorInRegistrationDuplicate?((0,n.wg)(),(0,n.iD)("div",Gn,"Oops, seems like nickname is already taken, try another.")):(0,n.kq)("",!0)])),e.registerDone?((0,n.wg)(),(0,n.iD)("div",Hn,[(0,n._)("div",Vn,[(0,n.Uk)(" Registration for nickname "+(0,h.zw)(e.usrNameTemp)+" is complete. You can now ",1),(0,n.Wm)(l,{to:{name:"Login"}},{default:(0,n.w5)((()=>[$n])),_:1})])])):(0,n.kq)("",!0)],64)}var qn=(0,n.aZ)({name:"Registration",data(){return{usrNameTemp:null,usrPwTemp:null,registerError:null,registerErrorNickName:null,requestOnTheFly:!1,registerDone:!1}},computed:{isRegistrateButtonDisabled(){return!!this.requestOnTheFly||!this.registrationDataOk},errorInRegistration(){return null!=this.registerError},errorInRegistrationDuplicate(){return null!=this.registerErrorNickName},registrationDataOk(){return!(!this.usrPwTemp||!this.usrNameTemp)&&(this.usrPwTemp!==this.usrNameTemp&&(!this.usrPwTemp.startsWith("1234567")&&(!this.usrPwTemp.startsWith("qwerty")&&(!this.usrPwTemp.startsWith(" ")&&!this.usrPwTemp.endsWith(" ")&&(!(this.usrPwTemp.length<8)&&!(this.usrNameTemp.length<1))))))}},created(){},methods:{showLogin(){},registrate(){this.registerError=null,this.registerErrorNickName=null,this.requestOnTheFly=!0;const e={method:"POST",headers:{"Content-Type":"application/json",Authorization:null},body:JSON.stringify({userName:this.usrNameTemp?.trim(),password:this.usrPwTemp.trim()})},t="http://35.217.7.146/portal/api/user/register";this.$store.dispatch("setLoadingStatus",!0),fetch(t,e).then((e=>(this.resetRegistrationData(),406===e.status?Promise.reject(406):200!==e.status?Promise.reject("error in login"):e.json()))).then((e=>{this.usrNameTemp=e.name,this.registerDone=!0}),(e=>{406===e?this.registerErrorNickName=!0:this.registerError=!0})).finally((()=>{this.requestOnTheFly=!1,this.$store.dispatch("setLoadingStatus",!1)}))},resetRegistrationData(){this.usrNameTemp=null,this.usrPwTemp=null}}});const zn=(0,Y.Z)(qn,[["render",Un]]);var Wn=zn;const Fn={class:"row"},Yn={class:"col text-danger"},Qn=(0,n.Uk)(" An error occured. Try navigating to "),Zn=(0,n.Uk)("main page");function Jn(e,t,s,a,i,o){const r=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("div",Fn,[(0,n._)("div",Yn,[Qn,(0,n.Wm)(r,{to:{name:"Home"}},{default:(0,n.w5)((()=>[Zn])),_:1})])])}var Xn=(0,n.aZ)({name:"Error",methods:{toMainPage(){this.$router.push("/")}},created(){}});const jn=(0,Y.Z)(Xn,[["render",Jn]]);var Kn=jn,ei=s(8637);const ti=(0,ei.MT)({state:{user:null,games:[],tables:[],users:[],theTable:null,commonChat:{messages:[],message:null},loadingStatus:!1},getters:{user(e){if(e.user)return e.user;const t=sessionStorage.getItem("userName"),s=sessionStorage.getItem("token");if(t&&s){const a={name:t,token:s};return ti.dispatch("setUser",a),e.user}return null},loading(e){return e.loadingStatus},userName(e){return e.user?e.user.name:null},users(e){return e.users},tables(e){return e.tables},games(e){return e.games},theTable(e){return e.theTable},chatMessages(e){return e.theTable&&e.theTable.chat?e.theTable.chat.messages:[]},commonChatMessages(e){return e.commonChat.messages},gameBoard(e){return e.theTable.board},loadingStatus(e){return e.loadingStatus},playerInTurn(e){return e.theTable.playerInTurn}},mutations:{setUser(e,t){t?(sessionStorage.setItem("userName",t.name),sessionStorage.setItem("token",t.token),e.user=t):(sessionStorage.removeItem("userName"),sessionStorage.removeItem("token"),e.user=t)},setGames(e,t){e.games=t},setTables(e,t){e.tables=t},clearTable(e){e.theTable=null},setUsers(e,t){e.users=t},updateScore(e,t){e.theTable&&(e.theTable.playerA.wins=t.winsA,e.theTable.playerB.wins=t.winsB,e.theTable.playerInTurn=null)},addTable(e,t){t.playerA.name===e.user.name?e.tables.unshift(t):e.tables.push(t)},removeFromPlayerList(e,t){e.users=e.users.filter((e=>e.name!==t.name))},removeTable(e,t){e.tables=e.tables.filter((e=>e.tableId!==t.tableId))},addPlayer(e,t){e.users.push(t)},startGame(e,t){const s=e.tables.findIndex((e=>e.tableId===t.tableId));e.tables.splice(s,1,t)},selectTable(e,t){let s={messages:[],message:{text:""}};t.chat=s;const a=t.board;t.board=a,e.theTable=t},addWatcher(e,t){if(e.theTable){let s=t.name.concat(" joined to watch");const a={from:"System",text:s};e.theTable.chat.messages.unshift(a)}},move(e,t){e.theTable.board.push(t)},changeTurn(e,t){e.theTable={...e.theTable,playerInTurn:t}},chat(e,t){e.theTable&&e.theTable.chat.messages.unshift(t)},updateCommonChat(e,t){e.commonChat.messages.unshift(t)},resign(e,t){e.theTable&&(e.theTable.playerA.wins=t.winsA,e.theTable.playerB.wins=t.winsB,e.theTable.playerInTurn=null)},leaveTable(e,t){if(e.theTable){(e.theTable.playerA.name===t||e.theTable.playerB.name===t)&&(e.theTable.playerInTurn=null);let s=t.concat(" left table");const a={from:"System",text:s};e.theTable.chat.messages.unshift(a)}},rematch(e,t){let s={messages:[],message:{text:""}};e.theTable&&e.theTable.chat&&(s=e.theTable.chat);const a={text:"Rematch started",from:"System"};s.messages.unshift(a),t.playerA.wins=t.playerA.wins,t.playerB.wins=t.playerB.wins,t.chat=s,e.theTable=t},updateWinner(e,t){if(this.state.theTable){e.theTable.playerInTurn=null;const s={text:t.winner.name.concat(" won"),from:"System"};e.theTable.chat.messages.unshift(s),e.theTable.win=t}},setDraw(e,t){if(this.state.theTable){e.theTable.playerA&&(e.theTable.playerA.draws=t.table.playerA.draws),e.theTable.playerB&&(e.theTable.playerB.draws=t.table.playerB.draws),e.theTable.playerInTurn&&(e.theTable.playerInTurn=null);const s={text:"Game ended in draw",from:"System"};e.theTable.chat.messages.unshift(s)}},setLoadingStatus(e,t){e.loadingStatus=t}},actions:{poolUpdate(e,t){},poolPlayTurn(e,t){},poolSetHandBall(e,t){},poolSelectPocket(e,t){},poolSetHandBallFail(e,t){},poolGameEnded(e,t){},setUser(e,t){e.commit("setUser",t)},setGames(e,t){e.commit("setGames",t)},setTables(e,t){e.commit("setTables",t)},setUsers(e,t){e.commit("setUsers",t)},addTable(e,t){e.commit("addTable",t)},removePlayer(e,t){e.commit("removeFromPlayerList",t)},removeTable(e,t){e.commit("removeTable",t)},addPlayer(e,t){e.commit("addPlayer",t)},startGame(e,t){e.commit("startGame",t)},selectTable(e,t){e.commit("selectTable",t)},addWatcher(e,t){e.commit("addWatcher",t)},move(e,t){e.commit("move",t)},changeTurn(e,t){e.commit("changeTurn",t)},chat(e,t){e.commit("chat",t)},updateCommonChat(e,t){e.commit("updateCommonChat",t)},resign(e,t){e.commit("resign",t)},updateScore(e,t){e.commit("updateScore",t)},rematch(e,t){e.commit("rematch",t)},clearTable(e){e.commit("clearTable")},leaveTable(e,t){e.state.theTable&&t.table&&e.state.theTable.tableId===t.table.tableId&&e.commit("leaveTable",t.who.name)},updateWinner(e,t){e.commit("updateWinner",t)},setDraw(e,t){e.commit("setDraw",t)},logout(e,t){e.commit("setTables",[]),e.commit("setUsers",[]),t&&t.webSocket&&(t.webSocket.close(),t.webSocket=null);const s={method:"POST",headers:{"Content-Type":"application/json",Authorization:null},body:JSON.stringify({token:t?.token})},a="http://35.217.7.146/portal/api/user/logout";e.commit("setUser",null),fetch(a,s).then((e=>{}))},setLoadingStatus(e,t){e.commit("setLoadingStatus",t)}}});var si=s(2119);const ai=[{path:"/portal/index.html",redirect:{name:"Home"}},{path:"/index.html",redirect:{name:"Home"}},{path:"/",redirect:{name:"Home"}},{path:"/portal",redirect:{name:"Home"}},{path:"/portal/home",component:_t,name:"Home"},{path:"/portal/instructions",component:an,name:"Instructions"},{path:"/portal/login",component:be,name:"Login",props:!0},{path:"/portal/registration",component:Wn,name:"Registration",props:!0},{path:"/portal/toplists",component:Us,name:"TopLists",props:!0},{path:"/portal/lobby",component:Ct,name:"Lobby",props:!0,beforeEnter:(e,t,s)=>{if(ti.state.user)s();else{const e=sessionStorage.getItem("userName"),t=sessionStorage.getItem("token");let a={name:e,token:t,webSocket:null};ti.dispatch("setUser",a).then((()=>{s()}))}}},{path:"/portal/table/:watch?",component:ns,name:"TableTicTacToe",props:!0,beforeEnter:(e,t,s)=>{ti.state.user&&ti.state.theTable?s():s("/")}},{path:"/portal/connectfour/:watch?",component:da,name:"TableConnectFour",beforeEnter:(e,t,s)=>{ti.state.user&&ti.state.theTable?s():s("/")}},{path:"/portal/pool/:watch?",component:qa,name:"PoolTable",props:!0,beforeEnter:(e,t,s)=>{ti.state.user&&ti.state.theTable?s():s("/")}},{path:"/portal/user/:selectedName/profile",component:Ss,name:"Profile",props:!0},{path:"/portal/terms",component:Ja,name:"Info"},{path:"/portal/feedback",component:kn,name:"Feedback"},{path:"/portal/:catchAll(.*)",component:Kn,name:"Error",props:!0}],ni=(0,si.p7)({history:(0,si.PO)(),routes:ai}),ii=(0,a.ri)(j);ii.use(ni).use(ti).mount("#app")}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,a,n,i){if(!a){var o=1/0;for(c=0;c<e.length;c++){a=e[c][0],n=e[c][1],i=e[c][2];for(var r=!0,l=0;l<a.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(r=!1,i<o&&(o=i));if(r){e.splice(c--,1);var h=n();void 0!==h&&(t=h)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[a,n,i]}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var n,i,o=a[0],r=a[1],l=a[2],h=0;if(o.some((function(t){return 0!==e[t]}))){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(l)var c=l(s)}for(t&&t(a);h<o.length;h++)i=o[h],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(c)},a=self["webpackChunktauhka_games"]=self["webpackChunktauhka_games"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(1707)}));a=s.O(a)})();